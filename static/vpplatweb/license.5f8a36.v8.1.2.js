webpackJsonp([18],{1230:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(14),i=l(n),s=a(459),d=l(s),o=a(54),u=l(o),r=a(55),c=l(r),p=a(59),f=l(p),m=a(93),h=l(m),b=a(8),v=l(b),V=a(4);a(1231);var E=function(e){function t(e){(0,u["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));return a.getData=function(){var e=a;(0,V.vpAdd)("/{vpplat}/vfrm/license/getlicense").then(function(t){var a=JSON.parse(t.data.info),l={},n={};a.modulelist.forEach(function(e,t){l[e.field]?l[e.field]+=1:l[e.field]=1,n[e.process]?n[e.process]+=1:n[e.process]=1}),e.setState({data:a,flag:t.data.flag,tabledata:a.modulelist,field:(0,i["default"])({},l),process:(0,i["default"])({},n)},function(){e.getheader()})})["catch"](function(e){"function"!=typeof e||e()})},a.change=function(){a.setState({entityVisible:!0})},a.downloadlicense=function(){(0,V.vpDownLoad)("/{vpplat}/vfrm/license/exportlicense").then(function(e){})},a.uploadSuccess=function(e,t){(0,V.VpAlertMsg)({message:"消息提示",description:"导入成功！",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),a.setState({entityVisible:!1},function(){location.reload([!1])})},a.cancelModal=function(){a.setState({entityVisible:!1,tabledata:[],tableheader:[]},function(){return a.getData()})},a.getheader=function(){var e=a,t=function(e,t,a){return{children:e,props:{}}},l=[{title:"功能级/子系统",width:"160",dataIndex:"process",render:function(t,a,l){var n={children:t,props:{}};return e.state.process[t]?(n.props.rowSpan=e.state.process[t],e.state.process[t]=0):(e.state.process[t],n.props.rowSpan=0),n}},{title:"模块",width:"190",dataIndex:"modular",render:t},{title:"授权用户数",dataIndex:"unum",width:"90",render:t},{title:"实际用户数",dataIndex:"actualnum",width:"90",render:t}];a.setState({tableheader:l})},a.uploadClick=function(){a.inputUploader.upload.on("beforeFileQueued",function(e){a.props.form.setFieldsValue({lic_label:e.name})})},a.onChange=a.onChange.bind(a),a.state={tabledata:[],data:{macaddress:"",startdate:"",expiresdate:""},entityVisible:!1,field:{},process:{},tableheader:[],filename:""},a}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.getData()}},{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(){}},{key:"onChange",value:function(e,t){}},{key:"handleSubmit",value:function(e){"upload"==e&&this.inputUploader.upload.upload()}},{key:"render",value:function(){var e=this,t=this,a=(t.state.data,{labelCol:{span:6},wrapperCol:{span:14}});return v["default"].createElement("div",{className:"license-container full-height p-b-xxlg"},v["default"].createElement("div",{className:"full-height license-box scroll"},v["default"].createElement(V.VpForm,null,v["default"].createElement("div",{className:"bg-white p-sm m-b-sm"},v["default"].createElement(V.VpRow,null,v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"公司名称",disabled:!0,value:t.state.data.company}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"产品名称",disabled:!0,value:t.state.data.product}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"产品简称",disabled:!0,value:t.state.data.abbreviation}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"产品版本",disabled:!0,value:t.state.data.svername})))),v["default"].createElement(V.VpRow,{className:"vp-form-item"},v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"授权类型",disabled:!0,value:t.state.data.authorization}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"授权期限",disabled:!0,value:t.state.data.startdate+"至"+t.state.data.expiresdate}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"授权用户",disabled:!0,value:t.state.data.name}))),v["default"].createElement(V.VpCol,{span:6},v["default"].createElement(V.VpFInput,(0,i["default"])({},a,{label:"授权IP",disabled:!0,value:t.state.data.ipaddress})))))),v["default"].createElement("div",{className:"bg-white p-sm"},v["default"].createElement(V.VpTable,{columns:this.state.tableheader,dataSource:this.state.tabledata,pagination:!1})),v["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},1==this.state.flag?v["default"].createElement(V.VpButton,{className:"m-r-xs",type:"primary",onClick:function(){return e.change()}},"更新License"):null,this.state.flag>=0?v["default"].createElement(V.VpButton,{className:"m-r-xs",type:"primary",onClick:function(){return e.downloadlicense()}},"下载License"):null,-1==this.state.flag?v["default"].createElement(V.VpButton,{className:"m-r-xs",type:"primary",disabled:!0},"下载License"):null)),v["default"].createElement(V.VpModal,{title:"更新License",visible:this.state.entityVisible,onCancel:function(){return e.cancelModal()},width:"50%",height:"60%",footer:null,wrapClassName:"modal-no-footer"},this.state.entityVisible?v["default"].createElement("div",{onClick:this.uploadClick},v["default"].createElement(V.VpInputUploader,{form:this.props.form,item:{field_name:"lic",widget_type:"inputupload",field_label:"选择文件",all_line:2,tips:"请选择文件（*.lic)",auto:!1,widget:{accept:{title:"lic",extensions:"lic"},upload_url:window.vp.config.URL.localHost+"/zuul/{vpplat}/vfrm/license/importfile"}},ref:function(t){return e.inputUploader=t},onUploadAccept:this.uploadSuccess})):null,v["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},v["default"].createElement(V.VpButton,{type:"primary",onClick:function(){return e.handleSubmit("upload")}},"更新License"))))}}]),t}(b.Component);t["default"]=E=(0,V.VpFormCreate)(E)},1231:function(e,t,a){var l=a(1232);"string"==typeof l&&(l=[[e.id,l,""]]);var n={hmr:!0};n.transform=void 0;a(465)(l,n);l.locals&&(e.exports=l.locals)},1232:function(e,t){}});