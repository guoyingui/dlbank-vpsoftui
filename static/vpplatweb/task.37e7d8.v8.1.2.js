webpackJsonp([19],{1233:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function endWithStr(e,t){var a=e.length-t.length;return a>=0&&e.lastIndexOf(t)==a}Object.defineProperty(exports,"__esModule",{value:!0});var _extends2=__webpack_require__(14),_extends3=_interopRequireDefault(_extends2),_stringify=__webpack_require__(323),_stringify2=_interopRequireDefault(_stringify),_toConsumableArray2=__webpack_require__(172),_toConsumableArray3=_interopRequireDefault(_toConsumableArray2),_getPrototypeOf=__webpack_require__(459),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=__webpack_require__(54),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(55),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=__webpack_require__(59),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(93),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(8),_react2=_interopRequireDefault(_react),_vpreact=__webpack_require__(4),_SearchForm=__webpack_require__(708),_SearchForm2=_interopRequireDefault(_SearchForm);__webpack_require__(1234);var _dynamictabs=__webpack_require__(905),_dynamictabs2=_interopRequireDefault(_dynamictabs),_vpbusiness=__webpack_require__(609),_dragbox=__webpack_require__(1236),_dragbox2=_interopRequireDefault(_dragbox),_gantt=__webpack_require__(1249),_gantt2=_interopRequireDefault(_gantt),_InputSearchName=__webpack_require__(721),_InputSearchName2=_interopRequireDefault(_InputSearchName),task=function(_Component){function task(props){(0,_classCallCheck3["default"])(this,task);var _this2=(0,_possibleConstructorReturn3["default"])(this,(task.__proto__||(0,_getPrototypeOf2["default"])(task)).call(this,props));_initialiseProps.call(_this2);var currentkey="filter",openKeys=["filter"],oproparm=_this2.props.params.sparam!=undefined?eval("("+_this2.props.params.sparam+")"):{};return _this2.state={filters:[],visible2:!1,visible:!1,showRightBox:!1,widget_show_none:"",widget_show_none_tool:"",table_headers:[],quickvalue:"",activeKey:"1",increaseData:[],tabs_array:[],tabs:null,isAdd:!1,formSearch_data:[],form_data:[],formdata:[],entityid:"",iids:"",row_id:"",row_entityid:"",entityiid:"",add:!0,statusList:[],varilsForm:{},viewtype:"",entityrole:!1,exShow:!1,exList:[],entityVisible:!1,toolbar:{},rowbar:[],SearchFormData:{},searchData:[],loading:!1,expandedRowKeys:[],tableHeight:"",tips:"",defaultActiveKey:"0",shrinkShow:!0,openKeys:openKeys,currentkey:currentkey,view:"tree",classList:[],statusFilters:[],classFilters:[],scode:"",sname:"",subItemProjectId:"",entitytype:!1,cardconfig:!1,defaultStatusList:[],statusboardlist:[],cardStatusList:[],multiSelect:[],flowtype:"",currentclassid:"",viewcode:"",tableloading:!0,editrowdata:{},VpUploader:!1,filearr:{},doctypelist:[],selectType:"",isaddflag:0,isdeleteflag:0,functionid:"",sparam:"",classListSelect:oproparm.iclassid||null,searchFormValues:{},conditionVisibleFlag:!1},_this2.objectid=0,_this2.closeRightModal=_this2.closeRightModal.bind(_this2),_this2.handleOk=_this2.handleOk.bind(_this2),_this2.handlesearch=_this2.handlesearch.bind(_this2),_this2.handleVisibleChange=_this2.handleVisibleChange.bind(_this2),_this2.onRowClick=_this2.onRowClick.bind(_this2),_this2.getHeader=_this2.getHeader.bind(_this2),_this2.cancelModal=_this2.cancelModal.bind(_this2),_this2.exTypeData=_this2.exTypeData.bind(_this2),_this2.handleMenuClick=_this2.handleMenuClick.bind(_this2),_this2.onExpand=_this2.onExpand.bind(_this2),_this2.handleDropDown=_this2.handleDropDown.bind(_this2),_this2.filterValue={currentkey:currentkey,openKeys:openKeys},_this2}return(0,_inherits3["default"])(task,_Component),(0,_createClass3["default"])(task,[{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.params;a?(a.entityid==this.props.params.entityid&&a.functionid==this.props.params.functionid||this.setState({entityid:a.entityid,showRightBox:!1,functionid:a.functionid,sparam:a.sparam,viewtype:""},function(){t.getHeader(),t.querySearchFormData(),t.queryclassList(),t.getconfig(),t.queryEntityType()}),a.type!=this.props.params.type&&this.setState({viewtype:a.type,functionid:a.functionid,sparam:a.sparam,showRightBox:!1},function(){t.getHeader(),t.querySearchFormData(),t.getconfig(),t.queryclassList(),t.queryEntityType()})):this.setState({viewtype:e.viewtype,entityid:e.entityid,toolbar:e.toolbar,rowbar:e.rowbar,functionid:a.functionid,sparam:a.sparam,showRightBox:!1},function(){t.getHeader(),t.getconfig(),t.tableRef.getTableData()})}},{key:"componentDidMount",value:function(){var e=this;this.setState({entityid:this.props.params?this.props.params.entityid:this.props.entityid,viewtype:this.props.params?this.props.params.type:this.props.type,functionid:this.props.params?this.props.params.functionid:"",sparam:this.props.params?this.props.params.sparam:"",toolbar:this.props.toolbar,rowbar:this.props.rowbar},function(){e.getHeader(),e.exTypeData(),e.getconfig(),e.querySearchFormData(),e.queryclassList(),e.queryEntityType(),e.queryTaskStatus(),e.loadDocType()}),$(".search").find("input").attr("maxlength",400)}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){}}},{key:"getHeader",value:function(){this.setState({tableloading:!0});var e=this;if("edit"==e.state.viewtype)return void this.getEditHeader();(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/getheaders",{entityid:e.state.entityid}).then(function(t){if(t&&t.hasOwnProperty("data")&&(e.setState({loading:!1,isdeleteflag:t.data.delflag==undefined?0:t.data.delflag,isaddflag:t.data.addflag==undefined?0:t.data.addflag}),t.data.hasOwnProperty("grid"))){var a=[];if(t.data.grid.hasOwnProperty("fields")){t.data.grid.fields.map(function(e,t){var i=void 0,n=void 0,s=void 0,r=void 0;for(var l in e)"field_label"==l?i=e[l]:"field_name"==l&&(n=e[l]),"fixed"==l&&(r=e[l]),"iwidth"==l&&(s=e[l]);i&&n&&("left"==r||"right"==r?a.push({title:i,dataIndex:n,key:n,width:s,fixed:r}):a.push({title:i,dataIndex:n,key:n,width:s,fixed:r,sorter:!0}))});var i=["bg-success","bg-warning","bg-danger"],n=_react2["default"].createElement("div",null,_react2["default"].createElement(_vpreact.VpTooltip,{title:"进度"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-tip",className:"m-r-xs text-success"})),_react2["default"].createElement(_vpreact.VpTooltip,{title:"状态"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-check",className:"m-r-xs text-success"})),_react2["default"].createElement(_vpreact.VpTooltip,{title:"文档"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-wenben",className:"m-r-xs text-success"}))),s={title:n,width:80,dataIndex:"indicator",key:"indicator",render:function(e,t){var a=t.lights&&1==t.lights.scheduleflag?0:1,n=t.lights&&1==t.lights.statusflag?1:0,s=t.lights?t.lights.fileflag:"";return _react2["default"].createElement("div",{className:"indic-wrapper inline-display"},_react2["default"].createElement(_vpreact.VpTooltip,{title:0==a?"正常进度":"进度逾期"},_react2["default"].createElement("span",{key:0,className:i[a]})),1==n?_react2["default"].createElement(_vpreact.VpTooltip,{title:"已完成"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-check",className:"m-r-xs text-success"})):null,1==s?_react2["default"].createElement(_vpreact.VpTooltip,{title:"文档"},_react2["default"].createElement("span",{key:3,className:"bg-success"})):"")}},r=a,l=e.state,o=l.entityid;l.viewtype;114==o&&r.unshift(s),r.map(function(e,t){if("icontrolmode"==e.key){var a=_react2["default"].createElement("div",{className:"inline-display"},"管控模式");e.title=a,e.width=120,e.render=function(e,t){return _react2["default"].createElement("div",{className:"indic-wrapper",style:{textAlign:"center"}},"2"==t.icontroltype?_react2["default"].createElement(_vpreact.VpTag,{color:"blue"},"敏捷"):_react2["default"].createElement(_vpreact.VpTag,{color:"yellow"},"瀑布"))}}}),r.push({title:"操作",fixed:"right",width:100,key:"operation",render:function(t,a){var i=[],n=!1;n=!("0"!=a.istatusflag||!e.state.entityaddrole||1!=e.state.isdeleteflag||"0"==a.principal&&"2"!=e.state.entityid),null!=vp.config.vpplat&&null!=vp.config.vpplat.operation&&vp.config.vpplat.operation.oprlist!=undefined&&vp.config.vpplat.operation.oprlist.map(function(e,t){if("collect"==e.key){var s=e.sname==undefined?"关注":e.sname;i.push({key:"collect",sname:0==a.ilike?s:"取消"+s,classname:"text-primary m-lr-xs cursor",type:1==a.ilike?"vpicon-star":"vpicon-star-o"})}else if("discuss"==e.key){var r=e.sname==undefined?"评论":e.sname;i.push({key:"discuss",sname:r,classname:"text-primary m-lr-xs cursor",type:"vpicon-pinglun"})}else if("delete"==e.key&&1==n){var l=e.sname==undefined?"删除":e.sname;i.push({key:"delete",sname:l,classname:"cursor m-r-xs f16 text-danger",type:"vpicon-shanchu"})}}),0==i.length&&(i.push({key:"collect",sname:0==a.ilike?"关注":"取消关注",classname:"text-primary m-lr-xs cursor",type:1==a.ilike?"vpicon-star":"vpicon-star-o"}),i.push({key:"discuss",sname:"评论",classname:"text-primary m-lr-xs cursor",type:"vpicon-pinglun"}),1==n&&i.push({key:"delete",sname:"删除",classname:"cursor m-r-xs f16 text-danger",type:"vpicon-shanchu"}));var s=[],r=vp.config.vpplat!=undefined&&vp.config.vpplat.operation!=undefined&&vp.config.vpplat.operation.count!=undefined?vp.config.vpplat.operation.count:2;return _react2["default"].createElement("span",null,i.map(function(t,i){if(i<r)return"delete"==t.key?_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"删除",key:t.key},_react2["default"].createElement(_vpreact.VpPopconfirm,{title:"确定要删除吗？",onConfirm:function(){return e.confirm(a.ientityid,a.iid)}},_react2["default"].createElement(_vpreact.VpIconFont,{onClick:function(e){e.stopPropagation()},className:t.classname,type:t.type}))):_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:t.sname,key:t.key},_react2["default"].createElement(_vpreact.VpIconFont,{onClick:function(i){return e.barEvent(t.key,i,a.ientityid,a.iid,a)},className:t.classname,type:t.type}));s.push(t)}),s.length>0?_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"更多"},e.state.isClickMenu?null:_react2["default"].createElement(_vpreact.VpDropdown,{overlay:_react2["default"].createElement(_vpreact.VpMenu,{onClick:function(t){return e.menuClick(t,a.ientityid,a.iid,a)}},s.map(function(e,t){return _react2["default"].createElement(_vpreact.VpMenuItem,{key:e.key},_react2["default"].createElement(_vpreact.VpIconFont,{className:e.classname,type:e.type}),e.sname)})),trigger:["click"],getPopupContainer:function(){return document.body}},_react2["default"].createElement(_vpreact.VpIconFont,{"data-id":a.iid,className:"cursor m-lr-xs f16",type:"vpicon-wait-y",onClick:function(e){return e.stopPropagation()}}))):null)}}),e.setState({table_headers:r,tableloading:!1})}}})["catch"](function(t){e.setState({tableloading:!1})})}},{key:"onExpand",value:function(e,t){if("pjtree"==this.state.viewtype&&"7"==t.ientityid&&e){var a=t.iid;(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/subList",{iid:a.substr(0,a.length-1)}).then(function(e){var a;t.children.splice(0);var i=e.data;(a=t.children).push.apply(a,(0,_toConsumableArray3["default"])(i))})}if(e)this.setState({expandedRowKeys:[].concat((0,_toConsumableArray3["default"])(this.state.expandedRowKeys),[t.key])});else{var i=this.state.expandedRowKeys.findIndex(function(e){return t.key===e});this.setState({expandedRowKeys:[].concat((0,_toConsumableArray3["default"])(this.state.expandedRowKeys.slice(0,i)),(0,_toConsumableArray3["default"])(this.state.expandedRowKeys.slice(i+1)))})}}},{key:"handleDropDown",value:function(e){try{e.stopPropagation()}catch(e){}}},{key:"exTypeData",value:function(){var e=this;(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/exListType",{entityid:this.state.entityid}).then(function(t){e.setState({exList:t.data})})}},{key:"onShowSizeChange",value:function(e){}},{key:"showModal",value:function(e){e.target.dataset.id;this.setState({showRightBox:!0,isAdd:!1})}},{key:"closeRightModal",value:function(){this.setState({showRightBox:!1,tabs_array:[],add:!1,istatusid:"",row_id:"",currentclassname:""}),"gantt"===this.state.view||this.tableRef.getTableData(),this.queryTaskStatus();try{this.props.setBreadCrumb()}catch(e){}}},{key:"handleStatusCancel",value:function(){this.setState({visible:!1,entityVisible:!1,varilsForm:{}})}},{key:"cancelModal",value:function(){this.setState({visible:!1,entityVisible:!1,varilsForm:{}})}},{key:"handleOk",value:function(){this.setState({showRightBox:!1}),this.saveRowData(this.props.form.getFieldsValue())}},{key:"handleVisibleChange",value:function(){if(!this.chooseVisible){this.state.SearchFormData.groups.length>0?this.setState({s_visible:!this.state.s_visible}):(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"暂无可搜索项，请配置搜索表单！",type:"error",onClose:this.onClose,closeText:"关闭",showIcon:!0},5)}}},{key:"onRowClick",value:function(e,t){var a=e.iid,i=e.sname,n=e.scode,s=e.ientityid;this.setState({showRightBox:!0,subItemProjectId:e.iprojectid,add:!1,entityiid:a,row_entityid:s,row_id:a,s_visible:!1,defaultActiveKey:"",sname:i,scode:n}),this.props.setBreadCrumb(i)}},{key:"handleMenuClick",value:function(e){var t=this,a=e.item.props.type,i=e.key;this.setState({extcurrentkey:i},function(){5==a?t.setState({entityVisible:!0}):(0,_vpreact.vpDownLoad)("/{vpplat}/vfrm/ent/exportfile",{quickvalue:t.state.quickvalue,ientityid:t.state.entityid,type:"expdata",viewcode:"expexcel",filtervalue:t.state.filtervalue,currentkey:t.state.currentkey,condition:(0,_stringify2["default"])(t.state.searchData),custparam:t.state.sparam})})}},{key:"handleSubmit",value:function(e){"upload"==e?this.inputUploader.upload.upload():(0,_vpreact.vpDownLoad)("/{vpplat}/vfrm/ent/exportfile",{ientityid:this.state.entityid,type:""})}},{key:"render",value:function(){var e=this,t=this,a=[],i=this.state,n=i.filtervalue,s=i.openKeys,r=i.currentkey,l=i.showRightBox,o=i.classList,c=i.classListSelect;"edit"==this.state.viewtype&&(a=[{title:"新增",tooltip:!1,className:"cursor blue",type:"plus-circle-o",iconClickFunction:this.handleEditAdd},{title:"保存",tooltip:!1,className:"cursor green",type:"save",iconClickFunction:this.handleEditSave},{title:"刷新",tooltip:!1,className:"cursor sky_blue",type:"reload",iconClickFunction:this.handleReload}]);var d=_react2["default"].createElement(_vpreact.VpMenu,{onClick:this.handleMenuClick,selectedKeys:[this.state.extcurrentkey]},t.state.exList.map(function(e,t){return _react2["default"].createElement(_vpreact.VpMenuItem,{key:e.iid,type:e.iviewtype},e.sname)})),u=_react2["default"].createElement("div",{className:"search-form bg-white ant-dropdown-menu"},_react2["default"].createElement(_SearchForm2["default"],{chooseModalVisible:this.chooseModalVisible,cancelSearch:this.cancelSearch,handleSearchForm:this.handleSearchForm,defaultSearchValues:this.state.searchFormValues,formData:this.state.SearchFormData,entityid:this.state.entityid,functionid:this.state.functionid,inputNameFlag:this.inputNameFlag})),p=_react2["default"].createElement(_vpreact.VpMenu,{onClick:this.handleNewClick},this.state.classList.map(function(e,t){return _react2["default"].createElement(_vpreact.VpMenuItem,{key:e.iid+","+e.scode},_react2["default"].createElement(_vpreact.VpIconFont,{type:e.icon})," ",e.sname)}));return _react2["default"].createElement("div",{className:"business-container pr full-height task"},_react2["default"].createElement("div",{className:"subAssembly b-b bg-white",style:this.props.style},_react2["default"].createElement(_vpreact.VpRow,{gutter:10},_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:4},_react2["default"].createElement("div",{className:"m-b-sm search"},_react2["default"].createElement(_vpbusiness.SeachInput,{placeholder:"请输入名称或编号",key:this.state.searchkey,onSearch:this.handlesearch,onChange:this.changesearch}))),_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row",span:4},o.length>1&&"card"===this.state.view&&!1&&_react2["default"].createElement(_vpreact.VpSelect,{defaultValue:c,placeholder:"请选择类别",style:{width:200},onChange:this.handleChange},o.map(function(e,t){return _react2["default"].createElement(_vpreact.VpOption,{value:e.iid,key:t},e.sname)}))),_react2["default"].createElement(_vpreact.VpCol,{className:"gutter-row text-right",span:16},"",1==this.state.isaddflag&&"card"!==this.state.view?this.state.classList.length>1?_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"快速创建"},_react2["default"].createElement(_vpreact.VpDropdown,{trigger:["click"],overlay:p},_react2["default"].createElement("div",{style:{display:"inline-block"}},_react2["default"].createElement(_vpreact.VpButton,{type:"primary",shape:"circle",icon:"plus",className:"m-l-xs"})))):_react2["default"].createElement("div",{style:{display:"inline-block"},onClick:function(){return e.handleQuikNewClick()}},_react2["default"].createElement(_vpbusiness.QuickCreate,null)):"","tree"==this.state.view?_react2["default"].createElement(_vpreact.VpDropdown,{trigger:["click"],overlay:d},_react2["default"].createElement("div",{style:{display:"inline-block"}},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"导入导出"},_react2["default"].createElement(_vpreact.VpButton,{type:"ghost",shape:"circle",className:"m-l-xs"},_react2["default"].createElement(_vpreact.VpIcon,{type:"cloud-upload"}))))):"",_react2["default"].createElement(_vpreact.VpDropdown,{onClick:this.handleVisibleChange,trigger:["click"],overlay:u,onVisibleChange:this.handleVisibleChange,visible:this.state.s_visible},_react2["default"].createElement("div",{style:{display:"inline-block"},id:"searchbox"},_react2["default"].createElement(_vpbusiness.FindCheckbox,null))),_react2["default"].createElement("div",{className:"fr m-l-xs"},_react2["default"].createElement(_vpreact.VpRadioGroup,{defaultValue:"tree",className:"radio-tab",onChange:this.handleViewChange},_react2["default"].createElement(_vpreact.VpRadioButton,{value:"gantt"},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"甘特图"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-task"}))),_react2["default"].createElement(_vpreact.VpRadioButton,{value:"card"},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"看板视图"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-fenlei"}))),_react2["default"].createElement(_vpreact.VpRadioButton,{value:"tree"},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"树视图"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-file-tree"}))),_react2["default"].createElement(_vpreact.VpRadioButton,{value:"edit"},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"编辑视图"},_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-demand"})))))))),_react2["default"].createElement("div",{className:"business-wrapper p-t-sm full-height",id:"table"},_react2["default"].createElement("div",{className:"bg-white p-sm entity-list full-height"},_react2["default"].createElement(_vpreact.VpRow,{gutter:16,className:"full-height"},_react2["default"].createElement(_vpreact.VpCol,{span:this.state.shrinkShow?"4":"0",className:"full-height menuleft"},_react2["default"].createElement(_vpreact.VpMenu,{className:"full-height scroll-y",onClick:this.handleClick,openKeys:this.state.openKeys,onOpen:this.onToggle,onClose:this.onToggle,selectedKeys:[this.state.filtervalue],mode:"inline"},_react2["default"].createElement(_vpreact.VpSubMenu,{key:"filter",title:_react2["default"].createElement("span",null,_react2["default"].createElement(_vpreact.VpIconFont,{type:"vpicon-filter",className:"m-r-xs"}),_react2["default"].createElement("span",{className:"f14"},"过滤器"))},this.state.filters.map(function(e,t){return _react2["default"].createElement(_vpreact.VpMenuItem,{className:"menu-text-overflow",key:e.value},_react2["default"].createElement("span",{className:"f14"},e.name))})))),_react2["default"].createElement(_vpreact.VpCol,{span:this.state.shrinkShow?"20":"24",className:"full-height scroll-y pr"},_react2["default"].createElement("div",{className:"togglebar cursor text-center",onClick:this.shrinkLeft},_react2["default"].createElement(_vpreact.VpIconFont,{className:"f12",type:this.state.shrinkShow?"vpicon-caret-left-s":"vpicon-caret-right-s"})),this.state.filtervalue==undefined||"tree"!==this.state.view&&"edit"!==this.state.view?null:_react2["default"].createElement("div",{className:"edit"==this.state.viewtype?"batch-table":"",style:{height:"100%"}},_react2["default"].createElement(_vpreact.VpTable,{loading:this.state.tableloading,ref:function(t){return e.tableRef=t},queryMethod:"POST",onExpand:this.onExpand,expandedRowKeys:this.state.expandedRowKeys,controlAddButton:function(t,a){e.controlAddButton(t,a)},dataUrl:"/{vpplat}/vfrm/entity/dynamicListData",params:{entityid:this.state.entityid,currentkey:this.state.currentkey,condition:(0,_stringify2["default"])(this.state.searchData),filtervalue:this.state.filtervalue,quickSearch:this.state.quickvalue,viewtype:"edit"==this.state.viewtype?"initeditlist":this.state.viewtype,datafilter:"auth",functionid:this.state.functionid,sparam:this.state.sparam},className:"taskTable",expandIconColumnIndex:1,columns:this.state.table_headers,onRowClick:"edit"==this.state.viewtype?null:this.onRowClick,tableOptions:a,bindThis:this,showTotal:"tree"==this.state.viewtype,rowKey:"iid",scroll:{y:this.state.tableHeight},resize:!0})),this.state.filtervalue!=undefined&&"card"===this.state.view&&_react2["default"].createElement(_dragbox2["default"],{classListSelect:this.state.classListSelect,functionid:this.state.functionid,sparam:this.state.sparam,entityid:this.state.entityid,filter:{filtervalue:n,openKeys:s,currentkey:r}}),this.state.filtervalue!=undefined&&"gantt"===this.state.view&&_react2["default"].createElement(_gantt2["default"],{filter:{filtervalue:n,openKeys:s,currentkey:r},params:{entityid:this.state.entityid,currentkey:this.state.currentkey,condition:(0,_stringify2["default"])(this.state.searchData),filtervalue:this.state.filtervalue,functionid:this.state.functionid,sparam:this.state.sparam,quickSearch:this.state.quickvalue,viewtype:"edit"==this.state.viewtype?"initeditlist":this.state.viewtype,datafilter:"auth",_k:this.state.timestamp},showRightBox:l}))))),_react2["default"].createElement("div",{className:"drawer-fixed p-sm hide"},_react2["default"].createElement("div",{className:"pr full-height"},_react2["default"].createElement("div",{className:"spin-icon",onclick:"closeDrawer"},_react2["default"].createElement(_vpreact.VpIcon,{type:"verticle-left"})),_react2["default"].createElement("div",{className:"drawer-box"}))),_react2["default"].createElement(_vpbusiness.RightBox,{max:!this.state.isAdd,button:_react2["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:""},_react2["default"].createElement(_vpreact.VpIcon,{type:"right"}))),tips:_react2["default"].createElement("div",{className:"tips p-xs"},_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:this.state.sname+"("+this.state.scode+")"},_react2["default"].createElement(_vpreact.VpIcon,{type:"exclamation-circle text-muted m-r-xs"}))),show:l},l?_react2["default"].createElement(_dynamictabs2["default"],{param:{entityid:this.state.row_entityid,iid:this.state.row_id,type:this.state.add,viewtype:this.state.viewtype,entitytype:this.state.entitytype,defaultActiveKey:this.state.defaultActiveKey,functionid:this.state.functionid,sparam:this.state.sparam},data:{currentclassid:this.state.currentclassid,viewcode:this.state.viewcode},setBreadCrumb:function(t){return e.props.setBreadCrumb(t+e.state.currentclassname)},closeRightModal:function(){return e.closeRightModal()},refreshList:function(){"gantt"===e.state.view?e.setState({showRightBox:!1}):e.tableRef.getTableData()}}):null),_react2["default"].createElement(_vpreact.VpModal,{title:"实体导入",visible:this.state.entityVisible,onCancel:function(){return e.cancelModal()},width:"70%",height:"80%",footer:null,wrapClassName:"modal-no-footer"},this.state.entityVisible?_react2["default"].createElement("div",{onClick:this.uploadClick},_react2["default"].createElement(_vpreact.VpInputUploader,{form:this.props.form,item:{field_name:"xls",widget_type:"inputupload",field_label:"选择文件",all_line:2,tips:"请选择文件（*.xls,*.xlsx)",auto:!1,widget:{accept:{title:"Xls",extensions:"xlsx,xls"},upload_url:window.vp.config.URL.localHost+"/zuul/{vpplat}/vfrm/ent/importfile?entityid="+this.state.entityid}},ref:function(t){return e.inputUploader=t},onUploadAccept:this.uploadSuccess})):null,_react2["default"].createElement("div",{className:"footFixed p-sm b-t text-center"},_react2["default"].createElement(_vpreact.VpButton,{type:"primary",onClick:function(){return e.handleSubmit("upload")}},"导入数据"),_react2["default"].createElement(_vpreact.VpButton,{style:{marginLeft:"10px"},type:"primary",onClick:function(){return e.handleSubmit("download")}},"下载模板"))),_react2["default"].createElement(_vpreact.VpModal,{title:"选择附件",visible:this.state.VpUploader,onOk:this.handleFileCancel,onCancel:this.handleFileCancel,width:"70%",height:"80%",wrapClassName:"modal-no-footer dynamic-modal"},this.state.VpUploader?_react2["default"].createElement(_vpreact.VpUploader,{server:"/zuul/{vpplat}/file/uploadfile",onUploadAccept:this.onUploadAccept,fileTypes:this.state.doctypelist,selectType:this.state.selectType}):null),_react2["default"].createElement(_vpreact.VpModal,{title:"名称",visible:this.state.conditionVisibleFlag,footer:null,onCancel:function(){return e.closeConditionModalFlag()},width:"30%",height:"40%",ref:"modal",closable:!0,maskClosable:!1},_react2["default"].createElement(_InputSearchName2["default"],{onCancel:this.closeConditionModalFlag,onOk:this.saveSearchCondition})))}}]),task}(_react.Component),_initialiseProps=function(){var e=this;this.loadDocType=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/doctype",{entityid:e.state.entityid}).then(function(t){e.setState({doctypelist:t.data,selectType:t.data[0].value})})},this.openupload=function(t){var a=t.iid;e.state.editrowdata[a]=t,e.setState({VpUploader:!0,currentiid:t.iid,editrowdata:e.state.editrowdata})},this.queryEntityType=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/entitytype",{entityid:e.state.entityid}).then(function(t){var a=t.data,i=a.entitytype,n=a.flowtype;e.setState({entitytype:i,flowtype:n})})},this.handleChange=function(t){e.setState({classListSelect:t})},this.handleClick=function(t){var a=t.key,i=t.keyPath.slice(1),n=t.keyPath.slice(1)[0];e.state.filtervalue==a&&e.state.currentkey==n||("filter"===n&&(e.filterValue={filtervalue:a,openKeys:i,currentkey:n}),e.setState({filtervalue:a,openKeys:i,currentkey:n,tableloading:!0}))},this.handleViewChange=function(t){var a=t.target.value,i=e.filterValue,n=i.currentkey,s=i.filtervalue,r=i.openKeys,l={view:a,viewtype:a},o="card"!==a&&"gantt"!==a;o||(l=(0,_extends3["default"])({},l,{currentkey:n,filtervalue:s,openKeys:r})),e.setState((0,_extends3["default"])({},l),function(){o&&e.getHeader()})},this.querySearchFormData=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/searchForm",{entityid:e.state.entityid,scode:"search"}).then(function(t){e.setState({SearchFormData:t.data.form})})},this.chooseModalVisible=function(t){e.chooseVisible=t},this.getconfig=function(){var t=e;(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/getConfig",{entityid:t.state.entityid}).then(function(e){if(e.hasOwnProperty("data")){if(e.data.hasOwnProperty("search")){var a=e.data.lastview;a=""==a||a==undefined?"0":a;var i=e.data.search.filters;t.filterValue.filtervalue=a,t.setState({filtervalue:a,widget_show_none:e.data.search,filters:i,statusFilters:e.data.search.statusFilters,classFilters:e.data.search.classFilters})}e.data.hasOwnProperty("toolbar")&&(t.setState({widget_show_none_tool:e.data.toolbar}),e.data.toolbar.hasOwnProperty("formSearch")&&e.data.toolbar.formSearch.hasOwnProperty("form")&&e.data.toolbar.formSearch.form.hasOwnProperty("groups")&&e.data.toolbar.formSearch.form.groups[0].hasOwnProperty("fields")&&(e.data.toolbar.formSearch.form.groups[0].fields[0].field_name="form_sname",t.setState({formSearch_data:e.data.toolbar.formSearch.form.groups[0].fields})),e.data.toolbar.hasOwnProperty("tabs")&&t.setState({tabs:e.data.toolbar.tabs}),e.data.hasOwnProperty("entityrole")&&t.setState({entityaddrole:e.data.entityrole}))}})},this.callBack=function(t){var a=t.iid;e.state.editrowdata[a]=t,e.setState({editrowdata:e.state.editrowdata})},this.getEditHeader=function(){var t=e,a={entityid:t.state.entityid,viewcode:"initeditlist",functionid:t.state.functionid,sparam:t.state.sparam};(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/initEditGrids",(0,_extends3["default"])({},a)).then(function(e){if(e&&e.hasOwnProperty("data")){var a=[],i=e.data.fields;if(0==i.length)return(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"未查询到编辑列表视图！",type:"error",onClose:this.onClose,closeText:"关闭",showIcon:!0},5),void t.setState({table_headers:[]});i.length;i.map(function(e,i){var n=void 0,s=void 0,r=void 0,l=void 0;for(var o in e)"field_label"==o?n=e[o]:"field_name"==o&&(s=e[o]),"fixed"==o&&(l=e[o]),"iwidth"==o&&(r=e[o]);n&&s&&("left"==l||"right"==l?a.push({title:n,dataIndex:s,key:s,width:r,fixed:l}):a.push({title:n,dataIndex:s,key:s,width:r,fixed:l,render:e.edit_col?function(a,i){return _react2["default"].createElement(_vpreact.EditTableCol,{callBack:t.callBack,record:i,widget:e.widget,item:(0,_extends3["default"])({},e.widget,{irelationentityid:e.irelationentityid}),value:a})}:null}))}),a.push({title:"操作",fixed:"right",width:120,key:"operation",render:function(e,a){return _react2["default"].createElement("span",null,_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"附件"},_react2["default"].createElement(_vpreact.VpIconFont,{onClick:function(){return t.openupload(a)},className:"text-primary m-lr-xs cursor",type:"vpicon-paperclip"})),"0"==a.istatusflag&&t.state.entityaddrole?_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"删除"},_react2["default"].createElement(_vpreact.VpPopconfirm,{title:"确定要删除这条信息吗？",onConfirm:function(){return t.confirm(a.ientityid,a.iid)},onCancel:t.cancel},_react2["default"].createElement(_vpreact.VpIconFont,{className:"cursor m-lr-xs text-danger",type:"vpicon-shanchu"}))):null,a.iid>0?_react2["default"].createElement(_vpreact.VpTooltip,{placement:"top",title:"查看详情"},_react2["default"].createElement(_vpreact.VpIconFont,{onClick:function(){return t.onRowClick(a,"")},className:"text-primary m-lr-xs cursor",type:"vpicon-navopen"})):null)}}),t.setState({table_headers:a,tableloading:!1})}})["catch"](function(e){t.setState({tableloading:!1})})},this.barEvent=function(t,a,i,n,s){if("summary"==t)e.setState({isClickMenu:!0}),(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/summary",{entityid:i,iid:n}).then(function(t){e.setState({isClickMenu:!1}),(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"计算汇总成功!",type:"success",onClose:e.onClose,closeText:"关闭",showIcon:!0},5)});else if("weekreport"==t)e.setState({isClickMenu:!0}),(0,_vpreact.vpQuery)("/{vppm}/weekport/addweekreport",{projectid:n,startdate:"",enddate:""}).then(function(t){e.setState({isClickMenu:!1}),(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"生成周报成功!",type:"success",onClose:e.onClose,closeText:"关闭",showIcon:!0},5)});else if("delete"==t){var r=e,l="";s&&(l=_react2["default"].createElement("div",null,_react2["default"].createElement("div",null,s.scode?"编号："+s.scode:""),_react2["default"].createElement("div",null,s.sname?"名称："+s.sname:""))),(0,_vpreact.VpConfirm)({title:"您是否确认要删除这条信息",content:l,onOk:function(){r.confirm(i,n)},onCancel:function(){}})}else"discuss"==t?e.discuss(a,i,n):"collect"==t?e.handleLike(a,i,n,s):("7"==i&&"pjtree"==e.state.viewtype&&(n=n.substr(0,n.length-1)),e.jumpTabs(t,i,n));try{a.stopPropagation()}catch(a){}},this.menuClick=function(t,a,i,n){e.barEvent(t.key,t,a,i,n)},this.discuss=function(t,a,i){try{t.stopPropagation()}catch(t){}var n="entity"+a+"_discuss";e.jumpTabs(n,a,i)},this.document=function(t,a,i){try{t.stopPropagation()}catch(t){}var n="entity"+a+"_file";e.jumpTabs(n,a,i)},this.jumpTabs=function(t,a,i){e.setState({defaultActiveKey:t+"tab",showRightBox:!0,entityiid:i,row_entityid:a,row_id:i})},this.documentList=function(t,a,i){try{t.stopPropagation()}catch(t){}var n="entity"+a+"_doclist";e.jumpDocListTabs(n,a,i)},this.jumpDocListTabs=function(t,a,i){(0,_vpreact.vpQuery)("/{vppm}/project/getProjectBySub",{subiid:i}).then(function(n){e.setState({defaultActiveKey:t+"tab",showRightBox:!0,subItemProjectId:n.data.iprojectid,entityiid:i,row_entityid:a,row_id:i})})},this.getExpandedRowa=function(t,a){var i=e,n=a;if(t.length){var s=[];t.map(function(e){n.push(e.key),e.hasOwnProperty("children")&&"pjtree"!=i.state.viewtype&&(s=i.getExpandedRowa(e.children,n),s.map(function(e){-1==n.findIndex(function(t){return e===t})&&n.push(e)}))})}return n},this.handleSearchForm=function(t,a){e.setState({searchData:t,searchFormValues:a,s_visible:!1})},this.inputNameFlag=function(){e.setState({conditionVisibleFlag:!0})},this.closeConditionModalFlag=function(){e.setState({conditionVisibleFlag:!1})},this.saveSearchCondition=function(t){(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/saveSearchForm",{entityid:e.state.entityid,functionid:e.state.functionid,sname:t,data:(0,_stringify2["default"])(e.state.searchData),formdata:(0,_stringify2["default"])(e.state.searchFormValues)}).then(function(t){var a=t.data;if(a){var i=e.state.searchFormValues;i.selectchildren=a,e.setState({selectchildren:a,conditionVisibleFlag:!1,searchFormValues:i}),(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"保存成功！",type:"success",onClose:e.onClose,closeText:"关闭",showIcon:!0},5)}})},this.handlesearch=function(t){e.setState({cur_page:1,quickvalue:t})},this.changesearch=function(t){var a=$.trim(t);e.state.quickvalue=a},this.confirm=function(t,a){var i=e;(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/deleteData",{iid:a,entityid:t}).then(function(e){i.tableRef.getTableData()})},this.queryentityRole=function(t,a){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/entity/entityRole",{entityid:t,iid:a}).then(function(t){e.setState({entityrole:t.data.entityRole})})},this.handleStatus=function(e,t,a){},this.uploadSuccess=function(t,a){(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"导入成功！",type:"success",onClose:e.onClose,closeText:"关闭",showIcon:!0},5),e.setState({entityVisible:!1},function(){return e.tableRef.getTableData()})},this.uploadClick=function(){e.inputUploader.upload.on("beforeFileQueued",function(t){e.props.form.setFieldsValue({xls_label:t.name})})},this.inputUploaderChange=function(e){},this.cancelSearch=function(){e.setState({s_visible:!1})},this.handleLike=function(t,a,i){try{t.stopPropagation()}catch(t){}(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/handleLike",{ientityid:a,iid:i}).then(function(t){e.tableRef.getTableData()})},this.shrinkLeft=function(t){e.setState({shrinkShow:!e.state.shrinkShow})},this.queryTaskStatus=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/tasks/statusList",{entityid:e.state.entityid,iclasssid:e.state.classListSelect}).then(function(t){e.setState({statusboardlist:t.data})})},this.onToggle=function(t){e.setState({openKeys:t.open?t.keyPath:t.keyPath.slice(1)})},this.queryclassList=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/tasks/classList",{entityid:e.state.entityid,sparam:e.state.sparam}).then(function(t){e.setState({classList:t.data,classListSelect:t.data[0].iid})})},this.handleNewClick=function(t){var a=t.key.split(",")[1],i=t.key.split(",")[0],n=t.domEvent.currentTarget.innerText;e.setState({showRightBox:!0,row_entityid:e.state.entityid,row_id:"",add:!0,entityiid:"",statusList:[],defaultActiveKey:"0",viewcode:a,currentclassid:i,currentclassname:n})},this.handleQuikNewClick=function(){var t=e.state.classList[0].scode,a=e.state.classList[0].iid,i=e.state.classList[0].sname;e.setState({showRightBox:!0,row_entityid:e.state.entityid,row_id:"",add:!0,entityiid:"",statusList:[],defaultActiveKey:"0",viewcode:t,currentclassid:a,currentclassname:i})},this.defaultConfig=function(){(0,_vpreact.vpQuery)("/{vpplat}/vfrm/tasks/initview",{mainentityid:e.state.mainentityid,mainentityiid:e.state.mainentityiid}).then(function(t){var a=[];""==t.data&&null==t.data||t.data.map(function(e,t){a.push({istatusid:e})}),e.setState({defaultStatusList:t.data,multiSelect:t.data,cardStatusList:a})})},this.handleStatusConfig=function(){e.setState({cardconfig:!e.state.cardconfig})},this.handleMultiSelect=function(t){e.setState({multiSelect:t})},this.statusDom=function(){var t={labelCol:{span:5},wrapperCol:{span:17}};return _react2["default"].createElement("div",{className:"task-boardform bg-white p-sm"},e.state.statusboardlist.length?_react2["default"].createElement(_vpreact.VpForm,{horizontal:!0,ref:"form",style:{marginTop:3}},_react2["default"].createElement(_vpreact.VpRow,null,_react2["default"].createElement(_vpreact.VpFSelect,(0,_extends3["default"])({label:"状态"},t),_react2["default"].createElement(_vpreact.VpSelect,{multiple:!0,placeholder:"请选择状态",defaultValue:e.state.defaultStatusList,onChange:e.handleMultiSelect},e.state.statusboardlist.map(function(e,t){return _react2["default"].createElement(_vpreact.VpOption,{key:t,value:e.iid},e.sname)}))),_react2["default"].createElement(_vpreact.VpCol,{sm:24,className:"text-center"},_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",style:{marginTop:10},type:"primary",onClick:e.okStatusConfig},"保存"),_react2["default"].createElement(_vpreact.VpButton,{className:"vp-btn-br",style:{marginTop:10,marginLeft:5},type:"ghost",onClick:e.cancleStatusConfig},"取消")))):"")},this.cancleStatusConfig=function(){e.setState({cardconfig:!1})},this.okStatusConfig=function(){var t=e.state.multiSelect;if(0==t.length)(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"请选择需要配置的状态列！",type:"error",onClose:e.onClose,closeText:"关闭",showIcon:!0},5);else{var a={multiSelect:t};(0,_vpreact.vpAdd)("/{vpplat}/vfrm/tasks/changeInitView",{param:(0,_stringify2["default"])(a)}).then(function(a){var i=[];t.map(function(e,t){i.push({istatusid:e})}),e.board.queryCardData(i),e.setState({cardStatusList:i,cardconfig:!1})})}},this.onRef=function(t){e.board=t},this.handleEditAdd=function(){e.tableRef.addTableRow({iid:e.objectid--});var t=vp.computedHeight(1,".taskTable");e.setState({tableHeight:t})},this.handleEditSave=function(){var t=e.state.editrowdata;if($.isEmptyObject(t))return void(0,_vpreact.VpAlertMsg)({message:"消息提示",description:"暂无可保存的数据！",type:"error",onClose:e.onClose,closeText:"关闭",showIcon:!0},5);var a=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];delete n.undefined,delete n.className;var s=e.state.filearr[n.iid];""!=s&&s!=undefined&&(n.fileinfo=s);for(var r in n)if(endWithStr(r,"val")){var l=r.replace("val","");n[l]=n[r]}n.iid=n.iid>0?n.iid:"",a.push(n)}(0,_vpreact.vpAdd)("/{vpplat}/vfrm/entity/saveEditData",{entityid:e.state.entityid,editData:(0,_stringify2["default"])(a)}).then(function(t){e.tableRef.getTableData(),e.setState({editrowdata:{},filearr:{}})})},this.handleReload=function(){e.setState({tableloading:!0}),e.tableRef.getTableData()},this.controlAddButton=function(t,a){var i=vp.computedHeight(a.length,".taskTable"),n=e.getExpandedRowa(a,[]);e.setState({tableloading:!1,expandedRowKeys:n,tableHeight:i})},this.onUploadAccept=function(t,a){var i=e,n={fileid:a.data.fileid,doctype:a.data.doctype};i.state.filearr[i.state.currentiid]!=undefined&&null!=i.state.filearr[i.state.currentiid]?i.state.filearr[i.state.currentiid]=[].concat((0,_toConsumableArray3["default"])(i.state.filearr[i.state.currentiid]),[n]):i.state.filearr[i.state.currentiid]=[n],e.setState({filearr:i.state.filearr})},this.handleFileCancel=function(){e.setState({VpUploader:!1})}};exports["default"]=task=(0,_vpreact.VpFormCreate)(task)},1234:function(e,t,a){var i=a(1235);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1235:function(e,t){},1236:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(171),s=i(n),r=a(323),l=i(r),o=a(14),c=i(o),d=a(459),u=i(d),p=a(54),f=i(p),h=a(55),m=i(h),v=a(59),y=i(v),_=a(93),g=i(_),k=a(8),b=i(k),w=a(4),E=a(609),x=a(1237),S=i(x),C=a(1244),V=i(C),R=a(905),N=i(R),D=a(726),M=i(D);a(1247);var T=function(e){function t(e){(0,f["default"])(this,t);var a=(0,y["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this,e));return a.getList=function(e){(0,w.vpQuery)("/{vpplat}/vfrm/tasks/board/statusList",(0,c["default"])({},e)).then(function(e){a.setState({data:e.data}),V["default"].data=e.data})},a.push=function(e){a.addData=(0,c["default"])({type:"push"},e),a.toogleModal()},a.unshift=function(e){a.addData=(0,c["default"])({type:"unshift"},e),a.toogleModal()},a.addList=function(){if(!a.selectValue)return void(0,w.VpAlertMsg)({message:"提示",description:"请选择新建项",type:"info",closeText:"关闭",showIcon:!0},5);var e=a.selectValue,t=e.value,i=e.children,n=e.data_typeid,s=a.state.data,r=a.addData.index,l=r===undefined?0:r,o="push"===a.addData.type,c={statusiid:t,statusname:i,isoff:0,entityid:114,typeiid:n};l=o?l+1:l,a.toogleList(c).then(function(e){var r=e.data;r&&r.success?(a.selectValue=null,s.splice(l,0,{statusiid:t,entityid:114,statusname:i,typeiid:n}),a.isRender=!0,a.setState({data:s,visible:!1},function(){return a.isRender=!1})):(0,w.VpAlertMsg)({message:"提示",description:s.msg,type:"error",closeText:"关闭",showIcon:!0},5)})},a["delete"]=function(e){var t=a.state.data,i=e.index,n=i===undefined?0:i,s=e.statusiid,r=e.statusname,l=e.typeiid,o={statusiid:s,statusname:r,isoff:1,entityid:114,typeiid:l};a.toogleList(o).then(function(e){200===e.status&&(a.isRender=!0,t.splice(n,1),a.setState({data:t},function(){return a.isRender=!1}))})},a.toogleList=function(e){return(0,w.vpAdd)("/{vpplat}/vfrm/tasks/board/isoff",{param:(0,l["default"])(e)})},a.toogleModal=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!a.state.visible;a.selectValue=null,a.setState({visible:e},function(){e&&(a.isRender=!0,a.getSelectList().then(function(e){a.setState({selectList:e.data,selectLoading:!1})},function(){return a.isRender=!1}))})},a._toogleModal=function(e,t){e&&a.setState((0,c["default"])((0,s["default"])({},e,!a.state[e]),t))},a.getSelectList=function(){return(0,w.vpQuery)("/{vpplat}/vfrm/tasks/board/statusAddList",{entityid:114})},a.sortList=function(){var e={iid:1,entityid:1,targetiid:targetiid};return(0,w.vpAdd)("/{vpplat}/vfrm/tasks/board/seq",{param:(0,l["default"])(e)})},a.batch=function(e){},a.itemClick=function(e){a.isRender=!0,a.setState({showBox:!0,itemData:e,data:V["default"].data},function(){return a.isRender=!1})},a.state={data:[],showBox:!1,itemData:{},visible:!1,title:"新建",selectList:[],selectLoading:!0,modalVisible:!1,excessData:{}},a.isRender=!1,a.selectValue=null,a.addData=null,a}return(0,g["default"])(t,e),(0,m["default"])(t,[{key:"componentDidMount",value:function(){this.getList({entityid:this.props.entityid,iclassid:this.props.classListSelect,functionid:this.props.functionid,sparam:this.props.sparam})}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentWillUnmount",value:function(){this.setState=function(){}}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,i=t.showBox,n=t.itemData,s=t.visible,r=t.title,l=t.selectList,o=t.selectLoading,d=t.modalVisible,u=t.excessData,p=this.props.filter,f=p.filtervalue,h=a.length||1;return b["default"].createElement("div",{className:"drag-box-view",key:f},b["default"].createElement(w.VpModal,{visible:s,title:r,onCancel:function(){return e.toogleModal()},onOk:this.addList,className:"drag-box-modal"},b["default"].createElement(w.VpSpin,{spinning:o,className:"spin",key:Date.now()},l.length?b["default"].createElement(w.VpSelect,{style:{display:"block"},onSelect:function(t,a){e.selectValue=a.props}},l.map(function(e){return b["default"].createElement(w.VpOption,{key:e.statusiid,data_typeid:e.typeiid,value:e.statusiid},e.statusname)})):b["default"].createElement("div",null,"无添加项"))),b["default"].createElement(E.RightBox,{show:i,max:!1,onClose:function(){return e.setState({showBox:!1})}},i&&b["default"].createElement(N["default"],{param:{entityid:n.ientityid,iid:n.iid,type:!1,viewtype:"edit",defaultActiveKey:""},setBreadCrumb:function(){},refreshList:function(){return n.page.getChildren()}})),b["default"].createElement("div",{className:"drag-box",ref:"drag",style:{width:265*h}},a instanceof Array&&a.length>0?a.map(function(t,a){return b["default"].createElement(S["default"],{key:a+"-"+t.statusname,index:a,data:(0,c["default"])({index:a},t),itemClick:e.itemClick,filter:p,action:{push:e.push,deleteFn:e["delete"],unshift:e.unshift,batch:e.batch,toogleModal:e._toogleModal},excessData:u})}):b["default"].createElement("div",{onClick:this.push,className:"more-list"},b["default"].createElement(w.VpIcon,{type:"plus",className:"icon"}))),d&&b["default"].createElement(w.VpModal,{title:"负责人",visible:d,onOk:function(){return e._toogleModal("modalVisible")},onCancel:function(){return e._toogleModal("modalVisible")},width:"70%",height:"100%",footer:null},b["default"].createElement(M["default"],{item:{widget_type:"selectmodel",irelationentityid:2},params:{currentclassid:"48",viewcode:"form"},visible:d,onOk:function(t){return e._toogleModal("modalVisible",{excessData:{roleid12:t}})},onCancel:function(){return e._toogleModal("modalVisible")},initValue:[]})))}}]),t}(k.Component);T.defaultProps={data:[]},t["default"]=T},1237:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(172),s=i(n),r=a(323),l=i(r),o=a(14),c=i(o),d=a(53),u=i(d),p=a(459),f=i(p),h=a(54),m=i(h),v=a(55),y=i(v),_=a(59),g=i(_),k=a(93),b=i(k),w=a(8),E=i(w),x=a(4),S=a(988),C=i(S),V=a(1238),R=i(V),N=a(1243),D=i(N),M=a(1244),T=i(M);a(1239),a(1245);var F=function(e){function t(e){(0,m["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,f["default"])(t)).call(this,e));L.call(a);var i=e.data,n=i.index,s=(0,u["default"])(i,["index"]);return a.state={data:s,index:n,add:!1,more:!1,addInput:null,key:Date.now(),filter:e.filter,spinShow:!1,loading:!1},a.numPerPage=10,a.currentPage=1,a.dragOptions=(0,c["default"])({},D["default"],{group:"drag-list",ghostClass:"moving",onAdd:function(e){var t=JSON.parse((0,l["default"])(T["default"].data)),i=e.from.dataset.index,n=e.to.dataset.index,s=e.oldIndex,r=e.newIndex,o=t[i],c=t[n];r>0&&r<c.children.length&&(c.children=c.children.slice(0,r).concat(o.children[s],c.children.slice(r))),0===r&&c.children[r]&&c.children.unshift(o.children[s]),r>=c.children.length&&c.children.push(o.children[s]),o.children.splice(s,1),(0,x.vpAdd)("/{vpplat}/vfrm/tasks/board/changeStatus",{param:(0,l["default"])({iid:c.children[r].iid,entityid:o.entityid,iendstatusid:c.statusiid})}),T["default"].data=t,a.sync(c)},onRemove:function(e){var t=JSON.parse((0,l["default"])(T["default"].data)),i=e.from.dataset.index,n=t[i];a.sync(n)}}),a}return(0,b["default"])(t,e),(0,y["default"])(t,[{key:"componentDidMount",value:function(){this.getChildren()}},{key:"componentWillReceiveProps",value:function(e){e.keys,this.props.keys}},{key:"componentWillUnmount",value:function(){this.setState=function(){}}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,i=t.add,n=t.more,s=t.key,r=t.spinShow,l=a.children,o=a.statusname,c=this.props,d=c.itemClick,u=c.index,p=this.props.excessData.roleid12,f=p===undefined?[]:p;return E["default"].createElement("div",{className:"drag-list",key:s,ref:"dragScroll"},E["default"].createElement(x.VpSpin,{spinning:r,className:"spin"}),E["default"].createElement("div",{className:"drag-list-title"},E["default"].createElement("p",{className:"float-left"},o),E["default"].createElement("div",{className:"icon-view float-right"},i?E["default"].createElement(x.VpIcon,{type:"cross",className:"icon",onClick:function(){return e.add(!1)}}):E["default"].createElement(x.VpIcon,{type:"plus",className:"icon",onClick:this.add}),E["default"].createElement(x.VpIcon,{type:"bars",className:"icon",onClick:this.actionMore}))),i&&E["default"].createElement("div",{className:"drag-item-add"},E["default"].createElement(x.VpInput,{onChange:function(t){return e.state.addInput=t.target.value},placeholder:"请填写任务标题"}),E["default"].createElement(x.VpInput,{className:"cursor",readOnly:!0,onClick:function(){return e.props.action.toogleModal("modalVisible")},suffix:E["default"].createElement("span",null,E["default"].createElement(x.VpIcon,{type:"search",style:{marginTop:7}})),value:f[0]?f[0].sname:"",placeholder:"请选择负责人"}),E["default"].createElement(x.VpButton,{type:"primary",onClick:this.onClick},"添加")),E["default"].createElement("div",{className:"drag-list-content "+u,ref:"drag","data-index":u},E["default"].createElement(C["default"],{data:l,index:u,dragItem:function(t,a){return E["default"].createElement(R["default"],{data:t,key:a,page:e,itemClick:d})},dragOptions:this.dragOptions})),n&&E["default"].createElement("div",{className:"drag-item-more"},E["default"].createElement("div",{className:"more-view"},E["default"].createElement("div",{className:"item",onClick:function(){return e.actionCollection({type:"push"})}},"在此列后添加新列表"),E["default"].createElement("div",{className:"item",onClick:function(){return e.actionCollection({type:"delete"})}},"删除本列"))))}}]),t}(w.Component);F.defaultProps={action:{push:null,unshift:null,deleteFn:null}};var L=function(){var e=this;this.add=function(){var t=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];e.state.addInput="",e.setState({add:t})},this.alertMsg=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"提示";return(0,x.VpAlertMsg)({message:t,description:e,type:"info",closeText:"关闭",showIcon:!0},5)},this.onClick=function(){if(!e.state.addInput)return void e.alertMsg("请输入内容");var t=e.state,a=t.data,i=(t.filter,e.props.excessData.roleid12),n=i===undefined?[]:i;if(!n[0])return void e.alertMsg("请选择负责人");e.setState({spinShow:!0});var s=a.statusiid,r=a.typeiid,o={sparam:(0,l["default"])({sname:e.state.addInput,iclassid:r,istatusid:s,scode:"",roleid12:n[0].iid}),entityid:114,variid:0,viewcode:"form"};(0,x.vpAdd)("/{vpplat}/vfrm/entity/saveFormData",(0,c["default"])({},o)).then(function(t){e.state.addInput="",e.getChildren()})},this.actionMore=function(t){e.setState({more:!e.state.more})},this.actionCollection=function(t){var a=e.props.action,i=a.push,n=a.unshift,s=a.deleteFn,r=a.batch,l=e.state.index,o=t.type;return"push"===o?void(i&&i((0,c["default"])({index:l},e.state.data))):"unshift"===o?void(n&&n((0,c["default"])({index:l},e.state.data))):"delete"===o?void(s&&s((0,c["default"])({index:l},e.state.data))):"checked"===o?void(r&&r(l)):void 0},this.getChildren=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1,a=arguments[1],i=e.state.data,n=i.statusiid,r=i.entityid,l=e.props.filter,o=l.currentkey,c=l.filtervalue,d=t,u="push"===a;e.setState({spinShow:!0}),u&&(d+=1),(0,x.vpAdd)("/{vpplat}/vfrm/entity/dynamicListData",{currentPage:d,numPerPage:e.numPerPage,entityid:r,filtervalue:c,istatusid:n,currentkey:o,viewtype:"board"}).then(function(t){var a=e.state,i=a.data,n=a.index;if(u){var r;e.currentPage+=1,(r=i.children).push.apply(r,(0,s["default"])(t.data.resultList))}else e.currentPage=1,i.children=t.data.resultList;T["default"].data[n]=i,e.setState({data:i,key:u?e.state.key:Date.now(),loading:!1,spinShow:!1})})},this.sync=function(t){e.setState({data:t,key:Date.now()})}};t["default"]=F},1238:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(14),s=i(n),r=a(459),l=i(r),o=a(54),c=i(o),d=a(55),u=i(d),p=a(59),f=i(p),h=a(93),m=i(h),v=a(8),y=i(v),_=a(4);a(1239),a(1241);var g=function(e){function t(e){(0,c["default"])(this,t);var a=(0,f["default"])(this,(t.__proto__||(0,l["default"])(t)).call(this,e));return a.edit=function(){var e=a.props,t=e.itemClick,i=e.page;t&&t((0,s["default"])({},a.props.data,{page:i}))},a.onChange=function(e){a.state.data.checked=e},a.data=e.data,a.state={data:e.data},a}return(0,m["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return!(e.data.text===this.props.data.text)}},{key:"render",value:function(){var e=this.props.data,t=e.sname,a=e.scode,i=(e.iid,e.checked,e.dcreatordate);return y["default"].createElement("div",{className:"drag-item"},y["default"].createElement("div",{className:"item-title"},y["default"].createElement("span",{style:{fontWeight:"bold"}},a),y["default"].createElement(_.VpIcon,{type:"book",className:"float-right edit",onClick:this.edit})),y["default"].createElement("div",{className:"item-info"},t),y["default"].createElement("div",{className:"item-footer"},i&&y["default"].createElement("div",{className:"item-time float-left"},y["default"].createElement(_.VpIcon,{type:"clock-circle"}),y["default"].createElement("span",null,i))))}}]),t}(v.Component);t["default"]=g},1239:function(e,t,a){var i=a(1240);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1240:function(e,t){},1241:function(e,t,a){var i=a(1242);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1242:function(e,t){},1243:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={animation:150,forceFallback:!1,sort:!1}},1244:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={}},1245:function(e,t,a){var i=a(1246);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1246:function(e,t){},1247:function(e,t,a){var i=a(1248);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1248:function(e,t){},1249:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(14),s=i(n),r=a(53),l=i(r),o=a(459),c=i(o),d=a(54),u=i(d),p=a(55),f=i(p),h=a(59),m=i(h),v=a(93),y=i(v),_=a(8),g=i(_),k=a(4),b=a(609),w=a(1005),E=i(w),x=a(905),S=i(x);a(1250);var C=function(e){function t(){(0,u["default"])(this,t);var e=(0,m["default"])(this,(t.__proto__||(0,c["default"])(t)).call(this));e.getList=function(t){e.setState({loading:!0});var a=(t.openKeys,(0,l["default"])(t,["openKeys"])),i=e.state.defaultValue;(0,k.vpAdd)("/{vpplat}/vfrm/entity/dynamicListData",(0,s["default"])({},e.props.params,{currentPage:1,numPerPage:10,viewtype:"gantt"==e.props.params.viewtype?"tree":e.props.params.viewtype},a)).then(function(t){var a=t.data.resultList;a=e.structureData(a),e.structureGantt(a,i),e.setState({data:a})})},e.getTaskStatus=function(e){var t=["success","warning","danger"],a=e.lights,i=a&&1==a.scheduleflag?0:1,n=a&&1==a.statusflag?1:0,s=t[i];return 1==n?s="completed":e.children instanceof Array&&e.children.length&&(s="fold"),s},e.structureData=function(t){var a=[],i=e;return t.map(function(e){var t=e.dstartdate,n=e.denddate,r=e.sname,l=e.id,o=e.iid,c=i.getTaskStatus(e);e.children instanceof Array?e.children.length>0&&function(){e.type="fold";var l=[],d="parent-"+e.iid;e.children.map(function(e){var t=e.dstartdate,a=e.denddate,n=e.sname,r=e.id,o=e.iid;if(t&&a){var c=i.getTaskStatus(e);l.push((0,s["default"])({},e,{name:n,start:t,end:a,id:r,iid:o,dependencies:[d],progress:100,className:c}))}}),l.unshift((0,s["default"])({},e,{iid:o,id:d,start:t,end:n,progress:100,name:r,className:c})),a.push.apply(a,l)}():t&&n&&a.push((0,s["default"])({},e,{start:t,end:n,progress:100,id:l,iid:o,name:r,className:c}))}),e.ganttData=a,a},e.structureGantt=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];e.setState({data:t,loading:!1})},e.foldGantt=function(t){var a=t.id,i=t.isFold,n=i!==undefined&&i,s=[];s=e.ganttData.map(function(e){return e.dependencies[0]===a&&(e.hidden=!n),e}),t.isFold=!t.isFold,e.structureGantt(s,e.state.defaultValue)},e.handleViewChange=function(t){e.setState({view_mode:t.target.value})},e.state={data:[],loading:!1,defaultValue:"Month",showBox:!1,itemData:{},view_mode:"Month"};return e.gantt=null,e.ganttData=[],e}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"componentDidMount",value:function(){this.getList(this.props.filter)}},{key:"componentWillReceiveProps",value:function(e){e.filter.filtervalue===this.props.filter.filtervalue&&e.filter.currentkey===this.props.filter.currentkey&&e.showRightBox||this.getList(e.filter)}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,i=t.data,n=t.defaultValue,s=t.showBox,r=t.itemData,l=t.view_mode;return g["default"].createElement("div",{className:"gantt-view"},g["default"].createElement(k.VpSpin,{spinning:a,className:"full-height"},g["default"].createElement("div",{className:"gantt-content full-height p-t-xxlg"},g["default"].createElement(E["default"],{data:i,options:{arrow_stroke:"green",on_click:function(t){var a=t.iid;a&&e.setState({itemData:{ientityid:114,iid:a},showBox:!0})},on_fold:function(t){e.foldGantt(t)}},view_mode:l})),g["default"].createElement("div",{className:"gantt-action"},g["default"].createElement(k.VpRadioGroup,{defaultValue:n,key:this.props.filter.filtervalue,onChange:this.handleViewChange},g["default"].createElement(k.VpRadioButton,{value:"Year"},g["default"].createElement("span",null,"年")),g["default"].createElement(k.VpRadioButton,{value:"Month"},g["default"].createElement("span",null,"月")),g["default"].createElement(k.VpRadioButton,{value:"Day"},g["default"].createElement("span",null,"日"))))),g["default"].createElement(b.RightBox,{show:s,max:!1,onClose:function(){return e.setState({showBox:!1})}},s&&g["default"].createElement(S["default"],{param:{entityid:r.ientityid,iid:r.iid,type:!1,viewtype:"edit",defaultActiveKey:""},setBreadCrumb:function(){},refreshList:function(){return e.getList(e.props.filter)}})))}}]),t}(_.Component);t["default"]=C},1250:function(e,t,a){var i=a(1251);"string"==typeof i&&(i=[[e.id,i,""]]);var n={hmr:!0};n.transform=void 0;a(465)(i,n);i.locals&&(e.exports=i.locals)},1251:function(e,t){}});