webpackJsonp([37],{1301:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(171),n=i(l),s=a(149),d=i(s),c=a(459),o=i(c),r=a(54),u=i(r),p=a(55),f=i(p),h=a(59),m=i(h),v=a(93),g=i(v),y=a(8),w=i(y),b=a(4),_=a(609),x=a(1302),E=i(x);a(1305);var k=function(e){function t(e){(0,u["default"])(this,t);var a=(0,m["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return a.handleCancel=function(){},a.handleOk=function(e){e[a.state.field_name]=a.state.data},a.handleChange=function(e){var t="";t+=e+",",a.setState({selectvalues:t.slice(0,-1)})},a.handlePersonChange=function(e){var t="";t+=e+",",a.setState({selectPersonvalues:t.slice(0,-1)})},a.selectStatus=function(){var e=[];(0,b.vpQuery)("/{vpplat}/csCaseExec/selectStatus").then(function(t){t.data.resultList.map(function(t,a){e.push(w["default"].createElement(b.VpOption,{key:t.iid},t.sname))}),a.setState({children:e})})},a.selectPerson=function(){var e=[];(0,b.vpQuery)("/{vpplat}/csCaseExec/selectPerson",{zxbz:a.state.radioValue,nodeId:a.state.nodeId,model_code:a.state.model_code,selectvalues:a.state.selectvalues}).then(function(t){t.data.resultList.map(function(t,a){e.push(w["default"].createElement(b.VpOption,{key:t.iassigntoval},t.iassignto_label))}),a.setState({personchildren:e,selectPersonvalues:""})})},a.getTreeData=function(){(0,b.vpQuery)("/{vpplat}/vptree/loadstructtree",{data_load:1,ui_id:"vpmtasktree"}).then(function(e){a.setState({treeData:e.data,tree_show_caption:e.data[0].tree_show_caption})})},a.loadData=function(e){return 1==e.props.async?(0,b.vpQuery)("/{vpplat}/vptree/loadstructtree",{data_load:1,ui_id:"vpmtasktree"}).then(function(t){a.refs.treeRef.addNewTreeData(e.props.eventKey,t.data)}):d["default"].resolve()},a.titleNode=function(e){return w["default"].createElement("div",null,w["default"].createElement(b.VpIcon,{tid:e.tree_field_id,className:"tree-icon",type:e.type||"file-text text-primary"}),e.level," ",e.name,null!=e.propertys?w["default"].createElement("span",{style:{background:"#2db7f5",margin:"0px 5px",padding:" 0 3px",color:"#fff"}},"管控点"):null)},a.onSelect=function(e,t){var i=(t.selected,t.selectedNodes,t.node);t.event,t.item;a.setState({nodeId:i.props.item.tid,model_code:i.props.item.model_code,waitParam:!1,selectPersonvalues:"",personchildren:""},function(){a.selectPerson()})},a.handleOk=function(){a.refs.treeRef.editTreeData(a.state.selectId,{name:a.state.inputValue}),a.setState({visible:!1})},a.handleCancel=function(){a.setState({visible:!1})},a.onChange=function(e){a.setState({inputValue:e.target.value})},a.onChanger=function(e){a.setState({radioValue:e.target.value,personchildren:"",selectPersonvalues:""},function(){a.selectPerson()})},a.multipleSearch=function(e){a.setState({s_visible:!1})},a["export"]=function(){(0,b.vpDownLoad)("/{vpplat}/vfrm/ent/exportfile",{filtervalue:"",quickvalue:a.state.quickvalue,ientityid:a.state.entityid,type:"expdata"})},a.packUpTree=function(){a.packUp()},a.packUp=function(){4==a.state.span1&&a.setState({span1:0,span2:24,display:"block"})},a.spreadOut=function(){a.setState({span1:4,span2:20,display:"none"})},a.state={maxHeight:$(window).height()-270,treeData:[],nodeId:"",model_code:"",visible:!1,s_visible:!1,tree_show_caption:"",multipleData:[],quickvalue:"",radioValue:1,entityid:a.props.routeParams.entityid,waitParam:!0,span1:4,span2:20,display:"none",personchildren:""},a.handlesearch=a.handlesearch.bind(a),a.handleVisibleChange=a.handleVisibleChange.bind(a),a}return(0,g["default"])(t,e),(0,f["default"])(t,[{key:"componentWillMount",value:function(){this.getTreeData(),this.selectStatus()}},{key:"componentDidMount",value:function(){this.setState({visible:!1})}},{key:"handlesearch",value:function(e){this.setState({quickvalue:e})}},{key:"handleVisibleChange",value:function(){this.setState({s_visible:!this.state.s_visible})}},{key:"render",value:function(){var e,t=this;return w["default"].createElement("div",{className:"full-height guo_vtmcaseHeader"},w["default"].createElement(b.VpRow,{gutter:6,className:"full-height"},w["default"].createElement(b.VpCol,(e={span:4},(0,n["default"])(e,"span",this.state.span1),(0,n["default"])(e,"className","full-height"),e),w["default"].createElement("div",{className:"full-height bg-white p-sm"},w["default"].createElement("h4",{className:"p-b-sm fw b-b"},this.state.tree_show_caption),w["default"].createElement("div",{style:{height:"94%"}},w["default"].createElement("div",{className:"full-height"},w["default"].createElement(b.VpTree,{ref:"treeRef",treeData:this.state.treeData,loadData:this.loadData,defaultExpandAll:!0,titleNode:this.titleNode,onSelect:this.onSelect,treeKey:"tree_field_id",draggable:!0,hasSearch:!0,packUp:function(){return t.packUp()}}),w["default"].createElement("div",{className:"cursor text-center",onClick:function(){return t.packUpTree()}},w["default"].createElement(b.VpIconFont,{type:"vpicon-navclose"})))))),w["default"].createElement(b.VpCol,{style:{paddingLeft:"9px"},span:this.state.span2,className:"full-height"},w["default"].createElement("div",{className:"shrink cursor text-center",onClick:function(){return t.spreadOut()},style:{display:this.state.display}},w["default"].createElement(b.VpIconFont,{type:"vpicon-navopen"})),w["default"].createElement("div",{className:"p-sm bg-white case-box-c2 full-height pr"},w["default"].createElement("div",{className:"PointerList b-b bg-white"},w["default"].createElement(b.VpRow,{gutter:20},w["default"].createElement(b.VpCol,{className:"gutter-left",span:5,style:{paddingTop:"2px"}},w["default"].createElement(_.SeachInput,{onSearch:this.handlesearch})),w["default"].createElement(b.VpCol,{span:19},w["default"].createElement(b.VpFRadio,null,w["default"].createElement(b.VpRadioGroup,{onChange:this.onChanger,defaultValue:"1"},w["default"].createElement(b.VpRadio,{key:"a",value:"1"},"我的"),w["default"].createElement(b.VpRadio,{key:"f",value:"5"},"全部")),w["default"].createElement(b.VpSelect,{multiple:!0,style:{width:"100px"},placeholder:"请选择人员",searchPlaceholder:"标签模式",onChange:this.handlePersonChange},this.state.personchildren),w["default"].createElement(b.VpSelect,{multiple:!0,style:{width:"400px",paddingLeft:"6px"},placeholder:"请选择执行结果",searchPlaceholder:"标签模式",onChange:this.handleChange},this.state.children))))),w["default"].createElement("div",{className:"full-height ",style:{paddingBottom:70}},w["default"].createElement(E["default"],{waitParam:this.state.waitParam,nodeId:this.state.nodeId,model_code:this.state.model_code,radioValue:this.state.radioValue,quickvalue:this.state.quickvalue,maxHeight:this.state.maxHeight,entityid:this.state.entityid,selectvalues:this.state.selectvalues,selectPersonvalues:this.state.selectPersonvalues}))))))}}]),t}(w["default"].Component);t["default"]=k},1302:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(171),n=i(l),s=a(323),d=i(s),c=a(14),o=i(c),r=a(459),u=i(r),p=a(54),f=i(p),h=a(55),m=i(h),v=a(59),g=i(v),y=a(93),w=i(y),b=a(8),_=i(b),x=a(4),E=a(609),k=a(709),C=a(905),V=i(C);a(1303);var S=function(e){function t(e){(0,f["default"])(this,t);var a=(0,g["default"])(this,(t.__proto__||(0,u["default"])(t)).call(this,e));return a.callBack=function(e){a.state.data.push(e)},a.changeBugStatus=function(e,t){(0,x.vpQuery)("/{vpplat}/csCaseExec/updateStatus",{ids:e.iid,status:t}).then(function(e){a.table.getTableData(),(0,x.VpAlertMsg)({message:"成功提示",description:"修改成功！",type:"success",closeText:"关闭",showIcon:!0})})},a.renderNewForm=function(){var e=a.state.defaultparam;return _["default"].createElement(V["default"],{param:{entityid:64,entitytype:3,iid:"",type:!0,viewtype:"",defaultActiveKey:"entity64_attrtab",formType:"tabs",mainentity:62,mainentityiid:a.state.iid,stabparam:"rglcsyl"},defaultparam:e,setBreadCrumb:function(e){},closeRightModal:function(){return a.closeQXRightModal()},refreshList:function(){}})},a.queryclassList=function(){(0,x.vpQuery)("/{vpplat}/vfrm/tasks/classList",{entityid:64}).then(function(e){var t=e.data;a.setState({classList:t})})},a.selectStatus=function(){var e=a,t=[];(0,x.vpQuery)("/{vpplat}/csCaseExec/selectStatus",{istatus:"0"}).then(function(i){i.data.resultList.map(function(e,i){t.push({value:e.iid+"",label:e.sname,scode:e.scode}),"通过"==e.sname&&a.setState({istatusidval:e.iid+""})}),a.setState({childrenBugClass2:t},function(){var t=[];(0,x.vpAdd)("/{vpplat}/vfrm/entity/editGrids",{entityid:62,viewcode:"editlistexec"}).then(function(i){i.data.fields.map(function(i,l){switch(i.field_name){case"scode":t.push({title:i.field_label,dataIndex:i.field_name,fixed:i.fixed,width:150,edit_col:i.edit_col,widget:i.widget,render:function(e,t){return _["default"].createElement("div",{key:e,title:e},e)}});break;case"istatusid":t.push({title:"执行状态",dataIndex:i.field_name,fixed:i.fixed,width:100,edit_col:i.edit_col,widget:i.widget,render:function(t,l){var n=l.istatusid;return"未执行"==n||n==undefined?(n="通过",l.istatusidval=a.state.istatusidval+""):l.istatusidval=l.istatusidval+"",_["default"].createElement("div",{title:n},_["default"].createElement(x.EditTableCol,{callBack:e.callBack,item:(0,o["default"])({},i,{ientityid:a.props.entityid}),id:"iid",data:e.state.data,record:l,widget:{widget_type:"select",widget_name:"istatusid",default_value_name:"istatusidval",load_template:a.state.childrenBugClass2},value:_["default"].createElement("span",{style:{color:"#428bca",cursor:"pointer"}},n)}))}});break;case"iassignto":t.push({title:"执行人",dataIndex:i.field_name,fixed:i.fixed,width:100,edit_col:i.edit_col,widget:i.widget,render:function(e,t){return _["default"].createElement("div",{key:e,title:e},e)}});break;case"ssjjg":t.push({title:i.field_label,dataIndex:i.field_name,fixed:i.fixed,width:150,edit_col:i.edit_col,widget:i.widget,render:function(t,l){return _["default"].createElement(x.EditTableCol,{callBack:e.callBack,item:(0,o["default"])({},i,{ientityid:a.props.entityid}),id:"iid",data:e.state.data,record:l,widget:i.widget,value:t})}});break;default:;t.push({title:i.field_label,dataIndex:i.field_name,fixed:i.fixed,width:150,edit_col:i.edit_col,widget:i.widget,render:function(e,t){return _["default"].createElement("span",{title:e},e)}})}}),t.push({title:"操作",fixed:"right",width:80,render:function(e,t){return _["default"].createElement("div",null,_["default"].createElement(x.VpTooltip,{placement:"top",title:"执行记录"},_["default"].createElement(x.VpIcon,{className:"cursor m-lr-xs f16 blue",type:"vpicon-lishijilu",onClick:function(){return a.showZXJL(t,!0)}})),a.getAddBugReact([t.iid]))}}),a.setState({plbjtableHeader:t})})})})},a.onSelectChange=function(e,t){a.setState({selectedRowKeys:e})},a.implementAll=function(){a.state.selectedRowKeys.length>=1?a.setState({implement_visible:!0}):(0,x.VpAlertMsg)({message:"消息提示",description:"请选择一条用例记录！",type:"info",closeText:"关闭",showIcon:!0})},a.Newdefects=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};0==a.state.selectedRowKeys.length||a.state.selectedRowKeys.length>1?(0,x.VpAlertMsg)({message:"消息提示",description:"请选择一行用例记录",type:"info",closeText:"关闭",showIcon:!0}):a._Newdefects(a.state.selectedRowKeys,!1,e)},a.handleNewFormClick=function(e,t){var i=e.key.split(",")[1],l=e.key.split(",")[0],n={isFat:334==l,defaultparam:{currentclassid:l,viewcode:i}};if(t)return void a._Newdefects(t,!1,n);a.Newdefects(n)},a._Newdefects=function(e,t,i){(0,x.vpQuery)("/{vpplat}/csCaseExec/isFat",{iid:e}).then(function(e){a.setState({isFat:e.data})}),a.setState((0,o["default"])({showQXRightBox:!0,implement_visible:!1,flag:t,iid:e},i))},a.Refresh=function(){a.table.getTableData()},a.tableChange=function(e,t,i){a.setState({selectedRowKeys:[]})},a.onRowClick=function(e){a.setState({showYLRightBox:!0,implement_visible:!1,flag:!1,iid:e.iid,row_entityid:62,row_id:e.iid,defaultActiveKey:"entity62_attrtab"})},a.showZXJL=function(e,t){a.setState({showYLRightBox:!0,implement_visible:!1,flag:t,iid:e.iid,defaultActiveKey:"entity62_exectab"})},a.closeRightModal=function(){a.setState({showYLRightBox:!1,implement_visible:a.state.flag},function(){try{a.table.getTableData()}catch(e){}})},a.closeQXRightModal=function(){a.setState({showQXRightBox:!1,implement_visible:a.state.flag})},a.implementOkModal=function(){var e=a.plbjtable.getCurrentData();(0,x.vpAdd)("/{vpplat}/csCaseExec/batchInsterExec",{sparam:(0,d["default"])(e)}).then(function(e){a.setState({implement_visible:!1}),a.table.getTableData(),(0,x.VpAlertMsg)({message:"成功提示",description:"保存成功！",type:"success",closeText:"关闭",showIcon:!0})})},a.implementCancelModal=function(){a.setState({implement_visible:!1})},a.getAddBugReact=function(){var e,t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,i=_["default"].createElement(x.VpMenu,{onClick:function(e){return a.handleNewFormClick(e,t)}},a.state.classList.map(function(e,t){return _["default"].createElement(x.VpMenuItem,{key:e.iid+","+e.scode},_["default"].createElement(x.VpIconFont,{type:e.icon})," ",e.sname)}));return _["default"].createElement(x.VpTooltip,{placement:"top",title:"新增缺陷"},_["default"].createElement(x.VpDropdown,{trigger:["click"],overlay:i},_["default"].createElement(x.VpButton,(e={type:"primary",shape:"circle"},(0,n["default"])(e,"type","vpicon-bug"),(0,n["default"])(e,"className","bug"),e),_["default"].createElement(x.VpIconFont,{type:"vpicon-bug"}))))},a.state={loading:!0,selectedRowKeys:[],implement_visible:!1,url:"/{vpplat}/csCaseExec/listPage",fiturl:"/{vpplat}/csCaseExec/filterListPage",plbjurl:"/{vpplat}/csCaseExec/listCasePage",tableHeader:[],plbjtableHeader:[],iid:"",showYLRightBox:!1,maxHeight:200,showQXRightBox:!1,data:[],flag:!1,istatusidval:"",childrenBugClass2:[],classList:[],defaultparam:{currentclassid:"",viewcode:""},row_entityid:62,row_id:""},a}return(0,w["default"])(t,e),(0,m["default"])(t,[{key:"componentWillMount",value:function(){var e=this,t=[];(0,x.vpAdd)("/{vpplat}/vfrm/entity/editGrids",{entityid:62,viewcode:"editlist"}).then(function(a){a.data.fields.map(function(e,a){if(e.iconstraint>=0)switch(e.field_name){case"dcreatordate":case"dmodified":case"dsjrq":case"dzxsj":t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:function(e,t){return _["default"].createElement("div",{title:(0,k.formatDateTime)(new Date(e))},(0,k.formatDateTime)(new Date(e)))}});break;case"scode":t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:function(e,t){return _["default"].createElement("div",{key:e,title:e},e)}});break;case"iassignto":t.push({title:"执行人",dataIndex:e.field_name,fixed:e.fixed,width:150,edit_col:e.edit_col,widget:e.widget,render:function(e,t){return _["default"].createElement("div",{key:e,title:e},e)}});break;case"istatusid":t.push({title:"执行状态",dataIndex:e.field_name,fixed:e.fixed,width:105,edit_col:e.edit_col,widget:e.widget,render:function(e,t){return _["default"].createElement("div",{key:e,title:e},e)}});break;default:var i=150;switch(e.field_name){case"iassignto":i=100;break;case"sname":i=180}t.push({title:e.field_label,dataIndex:e.field_name,fixed:e.fixed,width:i,edit_col:e.edit_col,widget:e.widget,render:function(t,a){var i=t;return e.widget&&e.widget.load_template&&e.widget.load_template.forEach(function(e){e.value==t&&(i=e.label)}),_["default"].createElement("div",{key:i,title:i},i)}})}}),t.push({title:"操作",fixed:"right",width:200,render:function(t,a){return _["default"].createElement("div",{onClick:function(e){return e.stopPropagation()}},e.state.childrenBugClass2.length>0?e.state.childrenBugClass2.filter(function(e){return!(!e.scode||-1==e.scode.indexOf("-s-"))}).map(function(t){var i=null,l=null;if(-1!=t.scode.indexOf("success")?(i="icon-checkcircleo",l="#52c41a"):-1!=t.scode.indexOf("fail")&&(i="icon-crosscircleo",l="#f5222d"),i&&a.istatusidval&&a.istatusidval!=t.value)return _["default"].createElement(x.VpTooltip,{placement:"top",title:t.label,key:t.value},_["default"].createElement(x.VpIcon,{className:"cursor m-lr-xs f16 blue "+i,type:i,style:{color:l},onClick:function(){return e.changeBugStatus(a,t.value)}}))}):"",_["default"].createElement(x.VpTooltip,{placement:"top",title:"执行记录"},_["default"].createElement(x.VpIcon,{className:"cursor m-lr-xs f16 blue",type:"vpicon-lishijilu",onClick:function(){return e.showZXJL(a,!1)}})),e.getAddBugReact([a.iid]))}}),e.setState({loading:!1,selectedRowKeys:[],tableHeader:t},function(){setTimeout(function(){if(200==e.state.maxHeight){var t=vp.computedHeight(0,".entityTable2")-30;$(".ant-table-placeholder").css("maxHeight",t+"px")}},800)})})}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){this.selectStatus(),this.queryclassList()}},{key:"render",value:function(){var e=this,t={onChange:this.onSelectChange,selectedRowKeys:this.state.selectedRowKeys},a=[{title:"执行",icon:"vpicon-ecutive",type:"vpicon-ecutive",onClick:this.implementAll},{title:"刷新",icon:"vpicon-reload",type:"vpicon-reload",onClick:this.Refresh}];return _["default"].createElement("div",{className:"guo_vtmcasesetexec autoHeight"},_["default"].createElement("div",{className:"text-right"},_["default"].createElement(x.VpWidgetGroup,{widgets:a})),_["default"].createElement(x.VpTable,{ref:function(t){e.table=t},onChange:this.tableChange,queryMethod:"GET",loading:this.state.loading,rowSelection:t,columns:this.state.tableHeader,dataUrl:1!=this.props.radioValue?this.state.fiturl:this.state.url,params:{entityid:this.props.entityid,scodeOrName:this.props.quickvalue,zxbz:this.props.radioValue,nodeId:this.props.nodeId,model_code:this.props.model_code,selectvalues:this.props.selectvalues,selectPersonvalues:this.props.selectPersonvalues},className:"entityTable2",scroll:{y:this.state.maxHeight,x:600},waitParam:this.props.waitParam,rowKey:"iid",onRowClick:this.onRowClick,bindThis:this,resize:!0,controlAddButton:function(t,a){var i=vp.computedHeight(a.length,".entityTable2")-30;e.setState({maxHeight:i,selectedRowKeys:[]})},customPagination:{pageSizeOptions:["10","20","30","40"]},defaultNumPerPage:10}),_["default"].createElement(E.RightBox,{max:!1,button:_["default"].createElement("div",{className:"icon p-xs",onClick:this.closeRightModal},_["default"].createElement(x.VpTooltip,{placement:"top",title:""},_["default"].createElement(x.VpIcon,{type:"right"}))),show:this.state.showYLRightBox},this.state.showYLRightBox?_["default"].createElement(V["default"],{param:{entityid:62,iid:this.state.iid,type:!1,viewtype:this.state.viewtype,entitytype:this.state.entitytype,defaultActiveKey:this.state.defaultActiveKey,formType:"tabs",mainentity:62,mainentityiid:this.state.iid,issubitem:"0",sfrom:"csexec"},defaultparam:{currentclassid:this.state.currentclassid,viewcode:this.state.viewcode},setBreadCrumb:function(e){},data:{currentclassid:"",viewcode:""},closeRightModal:function(){return e.closeRightModal()},refreshList:function(){return e.tableRef.getTableData()}}):null),_["default"].createElement(E.RightBox,{max:!1,button:_["default"].createElement("div",{className:"icon p-xs",onClick:this.closeQXRightModal},_["default"].createElement(x.VpTooltip,{placement:"top",title:""},_["default"].createElement(x.VpIcon,{type:"right"}))),show:this.state.showQXRightBox},this.state.showQXRightBox?this.renderNewForm():null),_["default"].createElement(x.VpModal,{width:"80%",style:{height:"700px"},title:"执行",visible:this.state.implement_visible,onOk:this.implementOkModal,onCancel:this.implementCancelModal,wrapClassName:"ant-modal-mask"},_["default"].createElement("div",{className:"full-height"},_["default"].createElement(x.VpTable,{ref:function(t){e.plbjtable=t},queryMethod:"GET",columns:this.state.plbjtableHeader,dataUrl:this.state.plbjurl,params:{iids:this.state.selectedRowKeys.join(",")},resize:!0,scroll:{y:"380px"},pagination:!1,bindThis:this,rowKey:"iid",customPagination:{pageSizeOptions:["10","20","30","40"]},defaultNumPerPage:10}))))}}]),t}(b.Component);t["default"]=S=(0,x.VpFormCreate)(S)},1303:function(e,t,a){var i=a(1304);"string"==typeof i&&(i=[[e.id,i,""]]);var l={hmr:!0};l.transform=void 0;a(465)(i,l);i.locals&&(e.exports=i.locals)},1304:function(e,t){},1305:function(e,t,a){var i=a(1306);"string"==typeof i&&(i=[[e.id,i,""]]);var l={hmr:!0};l.transform=void 0;a(465)(i,l);i.locals&&(e.exports=i.locals)},1306:function(e,t){}});