webpackJsonp([35],{1295:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(171),i=l(n),s=a(14),d=l(s),o=a(323),r=l(o),u=a(685),m=l(u),c=a(742),p=l(c),f=a(459),h=l(f),g=a(54),v=l(g),y=a(55),w=l(y),k=a(59),b=l(k),E=a(93),M=l(E),T=a(8),_=l(T),D=a(4),N=a(879),C=l(N);a(1296);var x=function(e){function t(e){(0,v["default"])(this,t);var a=(0,b["default"])(this,(t.__proto__||(0,h["default"])(t)).call(this,e));a.getDaysBG=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:a.getNowDate();(0,D.vpQuery)("/{vpplat}/bggl/getDaysBG",{userid:vp.cookie.getTkInfo().userid,selectdate:e}).then(function(e){var t=new p["default"],l=!0,n=!1,i=undefined;try{for(var s,d=(0,m["default"])(e.data);!(l=(s=d.next()).done);l=!0){var o=s.value;t.set(o.days,o.flag)}}catch(r){n=!0,i=r}finally{try{!l&&d["return"]&&d["return"]()}finally{if(n)throw i}}a.setState({bgMap:t})})["catch"](function(e){})},a.getCardData=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:a.getNowDate();(0,D.vpQuery)("/{vpplat}/bggl/getWorkHours",{selectdate:e}).then(function(t){var l=t.data;l.normal={okDay:null==l.days?0:l.days.okDay,okWeek:null==l.week?0:l.week.okWeek,okMonth:null==l.month?0:l.month.okMonth},a.setState({checkedDate:e,bgCardData:l})})["catch"](function(e){})},a.getBgData=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:a.getNowDate(),t=a.state.ue;t.tableLoading=!0,a.setState({ue:t}),(0,D.vpQuery)("/{vpplat}/bggl/timesheetlist",{userid:vp.cookie.getTkInfo().userid,selectdate:e}).then(function(e){var l=e.data,n=l.tasks,i=l.dayhours,s=i.sj_ihoursofday,d=i.sj_ioverhoursofday,o=!1;s+d==0&&(o=!0),t.tableLoading=!1,a.setState({tableDayhours:i,taskBtnDisabled:o},function(){return a.refs.sTable.updateSecondTable(a.state.headers,n)})})["catch"](function(e){})},a.onSelect=function(e,t){a.changeDate(e)},a.onPanelChange=function(e,t){a.changeDate(e)},a.dateCellRender=function(e){var t=a.getNowDate(new Date(e.getTime())),l=a.state.bgMap.get(t),n="normal";return 1==l?n="error":2==l&&(n="warning"),_["default"].createElement("div",null,0!=l&&l?_["default"].createElement("ul",{className:"events"},_["default"].createElement("li",null,_["default"].createElement("span",{className:"event-"+n},"●"))):null)},a.handleSubmit=function(e,t){var l=a.refs.sTable.getData();if(null==l)return!1;var n=a.state.ue;n.tableLoading=!0,a.setState({ue:n});var i="保存";"1"==t&&(i="提交"),(0,D.vpQuery)("/{vpplat}/bggl/timesheetsave",{userid:vp.cookie.getTkInfo().userid,selectdate:a.state.checkedDate,saveflag:t,insertList:(0,r["default"])(l.insertList),updateList:(0,r["default"])(l.updateList)}).then(function(e){(0,D.VpAlertMsg)({message:"消息提示",description:i+"成功",type:"success",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),a.getDaysBG(a.state.selectedDays),a.getBgData(a.state.checkedDate),a.getCardData(a.state.checkedDate)})["catch"](function(e){(0,D.VpAlertMsg)({message:"消息提示",description:i+"失败",type:"error",onClose:a.onClose,closeText:"关闭",showIcon:!0},5),n.tableLoading=!1,a.setState({ue:n})})},a.addTask=function(e){if(e){var t=a.state.checkedDate;a.setState({addTaskModalLoad:!0});var l=[];e.updateList.map(function(e){var t=JSON.parse(e.pjname);l.push({iapprovalstate:"0",ientityid:t.ientityid,iid:"0",imanhour:e.imanhour,imanovertime:e.imanovertime,iprojectid:t.iid,isubmitstate:"0",sdetail:e.sdetail,taskid:"0",taskname:e.taskname,tasktype:e.tasktype})}),(0,D.vpAdd)("/{vpplat}/bggl/timesheetsave",{userid:vp.cookie.getTkInfo().userid,selectdate:t,saveflag:"1",insertList:(0,r["default"])(l)}).then(function(e){a.initTaskModal({addTaskModalLoad:!1}),a.getDaysBG(t),a.getBgData(t),a.getCardData(t)})}},a.toogleModal=function(e){if("submit"===e){return void(!a.state.addTaskModalLoad&&a.addTask(a.refs.taskModalTable.getData()))}a.initTaskModal()},a.initTaskModal=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},t=a.refs.sTable.getData("addtask");if(t){var l=t.sumManhours,n=t.sumManovertimes,i=a.state.tableDayhours,s=i.sj_ihoursofday,o=i.sj_ioverhoursofday;if(l=(s-l).toFixed(2),n=(o-n).toFixed(2),l+n<=0)return void(0,D.VpAlertMsg)({message:"警告提示",description:"当前工时已满，不需要额外添加报工",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3);if(t.insertList.length>0)return void(0,D.VpAlertMsg)({message:"警告提示",description:"有未保存的新增报工，请先保存！",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3);var r=!a.state.taskModalVisible,u=Date.now();a.setState((0,d["default"])({taskModalVisible:r,addTaskModalLoad:r,taskModalKey:"task-modal-"+u},e),function(){r&&a.getListProject({sumManhours:l,sumManovertimes:n})})}},a.getListProject=function(e){(0,D.vpQuery)("/{vpplat}/bggl/listProject").then(function(t){var l=t.data||[];a.setState((0,d["default"])({},e,{listProject:l,addTaskModalLoad:!1}),function(){a.refs.taskModalTable.updateSecondTable(a.state.addTaskHeader,[{}])})})},a.deleteTD=function(e){var t=a.state.ue;t.tableLoading=!0,a.setState({ue:t}),(0,D.vpQuery)("/{vpplat}/bggl/deltimesheet",{iid:e.iid}).then(function(e){a.getDaysBG(),a.getCardData(),a.getBgData()})};var l=[{field_label:"hidden",field_name:"iid"},{field_label:"hidden",field_name:"ientityid"},{field_label:"hidden",field_name:"iprojectid"},{field_label:"hidden",field_name:"taskid"},{field_label:"hidden",field_name:"ihoursofday"},{field_label:"hidden",field_name:"sj_ihoursofday"},{field_label:"hidden",field_name:"isubmitstate"},{field_label:"hidden",field_name:"iapprovalstate"}],n=[{edit_col:!0,field_label:"所属项目",field_name:"pjname",iwidth:"20%"},{edit_col:!1,field_label:"",field_name:"pjmname",iwidth:"8%"},{edit_col:!0,field_label:"项目/任务名称",field_name:"taskname",iwidth:"16%"},{edit_col:!0,field_label:"活动类型",field_name:"tasktype",iwidth:"12%"},{edit_col:!0,field_label:"正常工时",field_name:"imanhour",iwidth:"12%"},{edit_col:!0,field_label:"加班工时",field_name:"imanovertime",iwidth:"12%"},{edit_col:!0,field_label:"详细工作内容",field_name:"sdetail",iwidth:"20%"}].concat(l),i=[{edit_col:!1,field_label:"项目/任务名称",field_name:"name",iwidth:"28%"},{edit_col:!1,field_label:"审批人",field_name:"pjmname",iwidth:"8%"},{edit_col:!0,field_label:"活动类型",field_name:"tasktypename",iwidth:"12%"},{edit_col:!0,field_label:"正常工时",field_name:"imanhour",iwidth:"12%"},{edit_col:!0,field_label:"加班工时",field_name:"imanovertime",iwidth:"12%"},{edit_col:!0,field_label:"详细工作内容",field_name:"sdetail",iwidth:"28%"}].concat(l);return a.state={bgMap:new p["default"],disabled:!1,chooseDate:new Date,checkedDate:a.getNowDate(),bgCardData:{days:{},week:{},month:{},over:{},normal:{}},loading:!1,headers:i,addTaskHeader:n,taskModalVisible:!1,taskModalKey:"task-modal-"+Date.now(),listProject:[],addTaskModalLoad:!1,tableDayhours:null,sumManhours:0,sumManovertimes:0,taskBtnDisabled:!1,isRequiredSdetails:!1,ue:{tableLoading:!0}},a}return(0,M["default"])(t,e),(0,w["default"])(t,[{key:"componentDidMount",value:function(){this.getDaysBG(),this.getCardData(),this.getBgData(),$(".ant-radio-group.ant-radio-group-small").css({display:"none"});var e=$(top.window).height()-210;this.refs.sTable.setTableHeight(e+"px")}},{key:"componentWillUnmount",value:function(){this.setState=function(){}}},{key:"getNowDate",value:function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date,t=e.getFullYear(),a=e.getMonth()+1,l=e.getDate();return t+"-"+(a<10?"0"+a:a)+"-"+(l<10?"0"+l:l)}},{key:"changeDate",value:function(e){var t=this.getNowDate(new Date(e.getTime()));t>this.getNowDate(new Date)?this.setState({chooseDate:new Date(e.getTime()),disabled:!0}):this.setState({chooseDate:new Date(e.getTime()),disabled:!1});var a=this.state.checkedDate;(0,D.vpFormatDate)(t,"YYYY-MM")!=(0,D.vpFormatDate)(a,"YYYY-MM")&&this.getDaysBG(t),this.getCardData(t),this.getBgData(t)}},{key:"render",value:function(){var e=this,t=this.state,a=t.taskModalVisible,l=t.taskModalKey,n=t.listProject,i=t.addTaskModalLoad,s=t.tableDayhours,o=t.sumManovertimes,r=t.sumManhours,u=t.bgCardData,m=(t.disabled,t.loading),c=t.taskBtnDisabled,p=t.ue;t.RelatedContentState,t.RelatedContentParams;return _["default"].createElement("div",{className:"full-height timeSheetClass"},_["default"].createElement(D.VpRow,{gutter:5,className:"full-height"},_["default"].createElement(D.VpCol,{span:5,id:"leftVpColDiv",className:"full-height scroll-y"},_["default"].createElement(D.VpRow,{span:5},_["default"].createElement("div",{className:"CalendarDiv"},_["default"].createElement(D.VpCalendar,{dateCellRender:this.dateCellRender,fullscreen:!1,onSelect:this.onSelect,onPanelChange:this.onPanelChange,value:this.state.chooseDate}))),_["default"].createElement(V,{val:u.normal,text:"正常报工",className:"CalendarDiv2",keys:["okMonth","okWeek","okDay"],texts:["本月报工","本周报工","当天报工"]}),_["default"].createElement(V,{val:u.over,text:"加班报工",className:"CalendarDiv3",keys:["overTimeMonth","overTimeWeek","overTimeDay"],texts:["本月加班","本周加班","当天加班"]})),_["default"].createElement(D.VpCol,{span:19,className:"full-height"},_["default"].createElement(D.VpRow,{span:20,className:"full-height"},_["default"].createElement("div",{className:"CalendarDiv3 full-height pr p-b-xxlg",style:{paddingTop:40}},_["default"].createElement("div",{className:"p-sm calendarPsm"},_["default"].createElement("div",{style:{display:"inline"}},_["default"].createElement("span",{className:"fontSpan"},"我的报工")),_["default"].createElement("div",{style:{display:"inline","float":"right"}},_["default"].createElement("span",{className:"fontSpanB"},"黑色"),_["default"].createElement("span",{className:"fontSpan2"},"--已录入"),_["default"].createElement("span",{className:"fontSpanL"},"蓝色"),_["default"].createElement("span",{className:"fontSpan2"},"--已提交"),_["default"].createElement("span",{className:"fontSpanH"},"红色"),_["default"].createElement("span",{className:"fontSpan2"},"--已拒绝"),_["default"].createElement("span",{className:"fontSpanG"},"绿色"),_["default"].createElement("span",{className:"fontSpan2"},"--已审批"))),_["default"].createElement(D.VpSpin,{spinning:p.tableLoading,className:"full-height p-xs calendar"},_["default"].createElement("div",{className:"full-height scroll-y"},_["default"].createElement(S,{ref:"sTable",dayhours:s,sdisabled:u.sdisabled,key:Date.now,deleteTD:this.deleteTD,isRequiredSdetails:this.state.isRequiredSdetails})),_["default"].createElement("div",{className:"footFixed text-center p-sm"},_["default"].createElement(D.VpButton,{type:"primary",className:"vp-btn-br",onClick:function(t){return e.handleSubmit(t,1)},disabled:u.sdisabled,loading:m},"提交"),_["default"].createElement(D.VpButton,{type:"ghost",className:"vp-btn-br",onClick:function(t){e.handleSubmit(t,0)},disabled:u.sdisabled,loading:m,style:{marginLeft:10}},"保存"),window.vp.config.vpm==undefined||window.vp.config.vpm.showOutTimesheet||undefined||0!=window.vp.config.vpm.showOutTimesheet?_["default"].createElement(D.VpButton,{type:"ghost",className:"vp-btn-br",onClick:this.toogleModal,disabled:u.sdisabled||c,style:{marginLeft:10}},"添加报工"):null)))))),_["default"].createElement(D.VpModal,{title:"添加报工",visible:a,onOk:function(){return e.toogleModal("submit")},onCancel:this.toogleModal,okText:"确定",cancelText:"取消",style:{height:"80%"},className:"taskModal",key:l,width:"80%",maskClosable:!1},_["default"].createElement(D.VpSpin,{spinning:i},_["default"].createElement(S,{ref:"taskModalTable",isAddTask:!0,listProject:n,dayhours:(0,d["default"])({},s,{sj_ihoursofday:r,sj_ioverhoursofday:o}),sdisabled:u.sdisabled,isRequiredSdetails:this.state.isRequiredSdetails}))))}}]),t}(T.Component),S=function(e){function t(e){(0,v["default"])(this,t);var a=(0,b["default"])(this,(t.__proto__||(0,h["default"])(t)).call(this,e));return a.widthMapping={},a.updateSecondTable=function(e,t){var l=a.props.isAddTask,n=a.genHeaders(e),i=a.genDataList(t,l),s="";i.length>0&&(s="none"),a.setState({headers:n,datalist:i,show:s,tableKey:Date.now()})},a.genHeaders=function(e){var t=[],l=a.props.dayhours;return e.map(function(e){if("hidden"==e.field_label)return null;var n=_["default"].createElement("th",{key:e.field_name},_["default"].createElement("span",null,e.field_label));"imanhour"===e.field_name&&(n=_["default"].createElement("th",{key:e.field_name},_["default"].createElement("span",null,e.field_label,"(",l.sj_ihoursofday,")"))),"imanovertime"===e.field_name&&(n=_["default"].createElement("th",{key:e.field_name},_["default"].createElement("span",null,e.field_label,"(",l.sj_ioverhoursofday,")"))),"kbgs"===e.field_name&&(n=_["default"].createElement("th",{key:e.field_name},_["default"].createElement("span",{title:"分配工时-已报工时"},e.field_label))),a.widthMapping[e.field_name]=e.iwidth,t.push(n)}),t},a.setTableHeight=function(e){a.setState({tableHeight:e})},a.checkedhours=function(e,t){var l=e.target.value,n=e.target.props,i=n.checkedVal,s=(n.checkedVal2,void 0),d=parseFloat(l);if("imanhour"==t?(s="正常工时",d+=parseFloat($(e.target).parent().parent().next().children().children().val())):(s="加班工时",d+=parseFloat($(e.target).parent().parent().prev().children().children().val())),parseFloat(l)>parseFloat(i))return(0,D.VpAlertMsg)({message:"警告提示",description:s+"不能大于"+i+"小时",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),e.target.value="",void e.target.focus()},a.onBlur=function(e){""==e.target.value&&(e.target.value=0)},a.onFocus=function(e){0==e.target.value&&(e.target.value="")},a.onKeyUp=function(e,t){var l=e.target.value;if(0!=parseFloat(l)&&!parseFloat(l)&&""!=l)return(0,D.VpAlertMsg)({message:"警告提示",description:"请输入正确的数据",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),e.target.value="",void e.target.focus();l=l.replace(/([0-9]+.[0-9]{2})[0-9]*/,"$1"),e.target.value=l,a.checkedhours(e,t)},a.genDataList=function(e,t){var a=[];if(0==e.length)return a;var l="",n=void 0,i=!0,s=!1,d=undefined;try{for(var o,r=(0,m["default"])(e);!(i=(o=r.next()).done);i=!0){var u=o.value;l!=u.pjname&&u.pjname!=undefined?(n={},l=u.pjname,n.name=u.pjname,n.pjmname=u.pjmname,n.className="parentTr",a.push(n)):u.pjname==undefined&&(u.name=u.name,u.className="lxzrwTr"),a.push(u)}}catch(c){s=!0,d=c}finally{try{!i&&r["return"]&&r["return"]()}finally{if(s)throw d}}return a},a.addTask=function(){var e=a.state.datalist;e.push([]),a.setState({datalist:e})},a.deleteTask=function(e){var t=a.state.datalist;t.splice(e,1,null),a.setState({datalist:t})},a.getTaskItem=function(e){var t=a.props.listProject,l=a.state["listDaily"+e],n=a.state["listTaskTpe"+e],i=a.state["projectType"+e],s=a.state["dailyLoad"+e]||!1,d="日常管理"===i,o="0"===a.props.dayhours.iworkflag,u="tdSelectFiexd"+e;return _["default"].createElement("tr",{className:"ant-table-row",key:e},_["default"].createElement("td",{style:{width:a.widthMapping.pjname,overflow:"visible"},key:"pjname",className:"pjnametd",id:u},_["default"].createElement("input",{name:"pjname",ref:"pjnameBox"+e,hidden:!0}),_["default"].createElement(D.VpSelect,{showSearch:!0,getPopupContainer:function(){return document.getElementById(u)},style:{width:"80%",marginLeft:"8px"},onSelect:function(t){return a.changeProject(t,e)}},t instanceof Array&&t.length>0&&t.map(function(e,t){return _["default"].createElement(D.VpOption,{key:t,value:(0,r["default"])(e)},e.sname)}))),_["default"].createElement("td",{style:{width:a.widthMapping.taskname,overflow:"visible"},key:"taskname",id:"pjname"+e},_["default"].createElement(D.VpSpin,{spinning:s},d?_["default"].createElement("div",null,_["default"].createElement("input",{name:"taskname",ref:"taskname"+e,hidden:!0}),_["default"].createElement(D.VpSelect,{showSearch:!0,style:{width:"100%"},getPopupContainer:function(){return document.getElementById("pjname"+e)},onSelect:function(t){var l=JSON.parse(t);a.refs["taskname"+e].value=l.sname,a.refs["tasktype"+e].value=l.iid}},l instanceof Array&&l.length>0&&l.map(function(e){return _["default"].createElement(D.VpOptGroup,{label:e.sname,style:{width:"100%"}},e.children.map(function(e,t){return _["default"].createElement(D.VpOption,{key:t,value:(0,r["default"])(e)},e.sname)}))}))):_["default"].createElement(D.VpInput,{name:"taskname",className:""}))),_["default"].createElement("td",{style:{width:a.widthMapping.tasktype,overflow:"visible"},key:"tasktype",className:"",id:"tasktype"+e},_["default"].createElement(D.VpSpin,{spinning:s},d?_["default"].createElement("p",null,"/",_["default"].createElement("input",{name:"tasktype",ref:"tasktype"+e,hidden:!0})):n instanceof Array&&n.length>0?_["default"].createElement("div",null,_["default"].createElement("input",{name:"tasktype",ref:"tasktype"+e,hidden:!0}),_["default"].createElement(D.VpSelect,{showSearch:!0,style:{width:"100%",marginLeft:"8px"},onSelect:function(t){return a.refs["tasktype"+e].value=t},getPopupContainer:function(){return document.getElementById("tasktype"+e)}},n.map(function(e){return _["default"].createElement(D.VpOptGroup,{label:e.sname},e.children.map(function(e,t){return _["default"].createElement(D.VpOption,{key:t,value:e.iid},e.sname)}))}))):_["default"].createElement("p",{style:{paddingLeft:"10px"}},"暂无任务类型",_["default"].createElement("input",{name:"tasktype",hidden:!0})))),_["default"].createElement("td",{style:{width:a.widthMapping.imanhour},key:"imanhour"},_["default"].createElement(D.VpInput,{type:"number",name:"imanhour",defaultValue:0,className:"",onFocus:function(e){return a.onFocus(e)},onBlur:function(e){return a.onBlur(e)},onKeyUp:function(e){return a.onKeyUp(e,"imanhour")},disabled:o})),_["default"].createElement("td",{style:{width:a.widthMapping.imanovertime},key:"imanovertime"},_["default"].createElement(D.VpInput,{type:"number",name:"imanovertime",defaultValue:0,className:"",onFocus:function(e){return a.onFocus(e)},onBlur:function(e){return a.onBlur(e)},onKeyUp:function(e){return a.onKeyUp(e,"imanovertime")}})),_["default"].createElement("td",{style:{width:a.widthMapping.sdetail,maxWidth:a.widthMapping.sdetail},key:"sdetail"},_["default"].createElement(D.VpInput,{name:"sdetail",type:"textarea",autosize:{minRows:1,maxRows:4},maxLength:1e3})))},a.getListTaskTpe=function(e,t){return a.setState((0,i["default"])({},"dailyLoad"+t,!0)),"日常管理"===e.sname?void a.getDailyTask(e,t):"工作项"===e.sname?void a.RelatedContenttoogleModal(e,t):void(0,D.vpQuery)("/{vpplat}/bggl/timeactivity",{projectid:e.iid}).then(function(e){var l;a.setState((l={},(0,i["default"])(l,"listTaskTpe"+t,e.data),(0,i["default"])(l,"projectType"+t,""),(0,i["default"])(l,"listDaily"+t,[]),(0,i["default"])(l,"dailyLoad"+t,!1),l))})},a.getDailyTask=function(e,t){(0,D.vpQuery)("/{vpplat}/bggl/timeactivity",{projectid:e.iid}).then(function(e){var l;a.setState((l={},(0,i["default"])(l,"listTaskTpe"+t,[]),(0,i["default"])(l,"projectType"+t,"日常管理"),(0,i["default"])(l,"listDaily"+t,e.data),(0,i["default"])(l,"dailyLoad"+t,!1),l))})},a.changeProject=function(e,t){a.refs["pjnameBox"+t].value=e,a.getListTaskTpe(JSON.parse(e),t)},a.getData=function(e){var t=a.props,l=t.isAddTask,n=t.isRequiredSdetails,i=new Array,s=new Array,d=a.props.dayhours,o=d.sj_ihoursofday,r=d.sj_ioverhoursofday,u=["iid","ientityid","iprojectid","taskid","imanhour","imanovertime","sdetail","isubmitstate","iapprovalstate"];l&&u.push.apply(u,["pjname","taskname","tasktype"]);var c=$(a.refs.tableView),p=c.find("input[name='imanhour']");if(0==p.length&&"addtask"!==e)return(0,D.VpAlertMsg)({message:"警告提示",description:"暂无可报工数据",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),null;for(var f=c.find("input[name='imanovertime']"),h=c.find("textarea[name='sdetail']"),g=c.find("input[name='pjname']"),v=c.find("input[name='taskname']"),y=0,w=0,k=0;k<p.length;k++){if(l){if(!g.get(k).value)return void(0,D.VpAlertMsg)({message:"警告提示",description:"请选择所属项目",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3);if(!v.get(k).value)return(0,D.VpAlertMsg)({message:"警告提示",description:"请填写任务名称",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),void v.get(k).focus();if(parseFloat(p.get(k).value)+parseFloat(f.get(k).value)<=0)return void(0,D.VpAlertMsg)({message:"警告提示",description:"请填写工时",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3)}if(parseFloat(p.get(k).value)+parseFloat(f.get(k).value)>0&&n&&""==h.get(k).value.replace(/ /g,""))return(0,D.VpAlertMsg)({message:"警告提示",description:"工作内容不能为空",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),h.get(k).value="",h.get(k).focus(),null;if(y+=parseFloat(p.get(k).value),w+=parseFloat(f.get(k).value),y>o)return void(0,D.VpAlertMsg)({message:"警告提示",description:"正常工时合计不能超过"+o+"小时",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3);if(w>r)return void(0,D.VpAlertMsg)({message:"警告提示",description:"加班工时合计不能超过"+r+"小时",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3);if(w>24-y)return(0,D.VpAlertMsg)({message:"警告提示",description:"每日报工总工时不能超过24小时",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),null}for(var b=0;b<p.length;b++){var E={},M=!0,T=!1,_=undefined;try{for(var N,C=(0,m["default"])(u);!(M=(N=C.next()).done);M=!0){var x=N.value;if("sdetail"==x)E[x]=c.find("textarea[name='"+x+"']").get(b).value;else{var S=c.find("input[name='"+x+"']").get(b);S&&(E[x]=S.value)}}}catch(V){T=!0,_=V}finally{try{!M&&C["return"]&&C["return"]()}finally{if(T)throw _}}"-1"!=E.iid||"0"==E.imanhour&&"0"==E.imanovertime?"-1"==E.iid||"1"==E.isubmitstate&&"1"==E.iapprovalstate||i.push(E):s.push(E)}return 0==s.length&&0==i&&"addtask"!==e?((0,D.VpAlertMsg)({message:"警告提示",description:"请先填写报工",type:"warning",onClose:a.onClose,closeText:"关闭",showIcon:!0},3),null):{insertList:s,updateList:i,sumManhours:y,sumManovertimes:w}},a.RelatedContenttoogleModal=function(e,t){var l=a.state.RelatedContentState;l.visible=!l.visible,t!==undefined&&(l.index=t),a.setState((0,i["default"])({RelatedContentState:l},"dailyLoad"+t,!1))},a.RelatedContentOk=function(e){},a.state={show:"",tableHeight:"195px",headers:[],datalist:[],listTaskTpe:[],projectType:"",listDaily:[],dailyLoad:!1,tableKey:"",RelatedContentParams:{entityid:114,iid:80,origin:""},RelatedContentState:{visible:!1}},a}return(0,M["default"])(t,e),(0,w["default"])(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.datalist,l=t.headers,n=t.tableKey,i=t.RelatedContentState,s=t.RelatedContentParams,d=this.props,o=d.dayhours,r=d.sdisabled,u=d.isAddTask;if(!o||r===undefined)return null;var m=this.props.dayhours.sj_ihoursofday,c=m===undefined?0:m;return _["default"].createElement("div",{className:"ant-table-content",ref:"tableView"},_["default"].createElement("div",{className:"ant-table-scroll",style:{overflow:"initial"}},_["default"].createElement("div",{className:"ant-table-header"},_["default"].createElement("table",{className:"ant-table-fixed",style:{tableLayout:"fixed",width:"100%"}},_["default"].createElement("colgroup",null,_["default"].createElement("col",{style:{width:this.widthMapping.name,minWidth:this.widthMapping.name,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.pjmname,minWidth:this.widthMapping.pjmname,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.tasktypename,minWidth:this.widthMapping.tasktypename,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.imanhour,minWidth:this.widthMapping.imanhour,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.imanovertime,minWidth:this.widthMapping.imanovertime,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.sdetail,minWidth:this.widthMapping.sdetail,overflow:"visible"}})),_["default"].createElement("thead",{className:"ant-table-thead"},_["default"].createElement("tr",null,l)))),_["default"].createElement("div",{className:"nodata",style:{display:this.state.show,height:this.state.tableHeight}}),_["default"].createElement("div",{id:"diyDIV",className:"ant-table-body",style:{display:""==this.state.show?"none":"",height:u?"auto":this.state.tableHeight}},_["default"].createElement("table",{className:"ant-table-fixed",style:{tableLayout:"fixed",width:"100%"},key:n},_["default"].createElement("colgroup",null,_["default"].createElement("col",{style:{width:this.widthMapping.name,minWidth:this.widthMapping.name,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.pjmname,minWidth:this.widthMapping.pjmname,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.tasktypename,minWidth:this.widthMapping.tasktypename,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.imanhour,minWidth:this.widthMapping.imanhour,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.imanovertime,minWidth:this.widthMapping.imanovertime,overflow:"visible"}}),_["default"].createElement("col",{style:{width:this.widthMapping.sdetail,minWidth:this.widthMapping.sdetail,overflow:"visible"}})),_["default"].createElement("tbody",{className:"ant-table-tbody"},a.map(function(t,a){if(!t)return null;if("parentTr"==t.className)return _["default"].createElement("tr",{key:t.name},_["default"].createElement("td",{className:t.className},t.name),_["default"].createElement("td",{style:{width:e.widthMapping.pjmname,minWidth:e.widthMapping.pjmname,overflow:"visible"},className:t.className},t.pjmname),_["default"].createElement("td",{colSpan:4,className:t.className}));var l="",n=!1,i=!1,s=20,d=1===t.inorout||3===t.inorout;if(r&&(n=!0),1==t.isubmitstate&&0==t.iapprovalstate?l="fontL":1==t.isubmitstate&&1==t.iapprovalstate?(l="fontG",n=!0,d=!1):1==t.isubmitstate&&2==t.iapprovalstate&&(l="fontH"),0==c&&(i=!0),"lxzrwTr"==t.className&&(s=0),t.kbgs<=0&&"fontH",u)return e.getTaskItem(a);var o="";return""!=t.saudittext&&2==t.iapprovalstate&&(o="审批意见：\r\n"+t.saudittext),_["default"].createElement("tr",{className:"ant-table-row",key:t.ientityid+"--"+t.iprojectid+"--"+t.taskid,title:""+o},_["default"].createElement("td",{key:"name",className:l},_["default"].createElement("span",{style:{marginLeft:s}},d&&_["default"].createElement(D.VpPopconfirm,{title:"确定要删除这个任务吗？",onConfirm:e.props.deleteTD.bind(e,t)},_["default"].createElement(D.VpIcon,{type:"minus-circle",placement:"top",title:"计划外报工",className:"m-r-xs",style:{color:"red"}})),!d&&7==t.ientityid&&_["default"].createElement(D.VpIconFont,{type:"vpicon-word",placement:"top",title:"项目计划内WBS报工",className:"m-r-xs"}),!d&&114==t.ientityid&&_["default"].createElement(D.VpIconFont,{type:"vpicon-task",placement:"top",title:"计划内任务报工",className:"m-r-xs"}),t.name)),_["default"].createElement("td",{key:"pjmname",className:l},_["default"].createElement("span",null,t.pjmname)),_["default"].createElement("td",{key:"tasktypename",className:l},_["default"].createElement("span",{style:{marginLeft:s}},t.tasktypename)),_["default"].createElement("td",{key:"imanhour"},_["default"].createElement(D.VpInput,{name:"imanhour",className:l,defaultValue:t.imanhour,onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)},onKeyUp:function(t){return e.onKeyUp(t,"imanhour")},checkedVal:c,disabled:n||i})),_["default"].createElement("td",{key:"imanovertime"},_["default"].createElement(D.VpInput,{name:"imanovertime",className:l,defaultValue:t.imanovertime,onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)},onKeyUp:function(t){return e.onKeyUp(t,"imanovertime")},checkedVal:24-c,disabled:n})),_["default"].createElement("td",{style:{paddingRight:"2% !important"},key:"sdetail"},_["default"].createElement(D.VpInput,{name:"sdetail",type:"textarea",autosize:{minRows:1,maxRows:4},maxLength:1e3,defaultValue:null==t.sdetail?"":t.sdetail,disabled:n}),_["default"].createElement("input",{name:"iid",type:"hidden",value:t.iid}),_["default"].createElement("input",{name:"ientityid",type:"hidden",value:t.ientityid}),_["default"].createElement("input",{name:"iprojectid",type:"hidden",value:t.iprojectid}),_["default"].createElement("input",{name:"taskid",type:"hidden",value:t.taskid}),_["default"].createElement("input",{name:"ihoursofday",type:"hidden",value:t.ihoursofday}),_["default"].createElement("input",{name:"isubmitstate",type:"hidden",value:t.isubmitstate}),_["default"].createElement("input",{name:"iapprovalstate",type:"hidden",value:t.iapprovalstate})))})))),u&&_["default"].createElement("div",{className:"table-action",style:{marginTop:"5px"}},_["default"].createElement(D.VpButton,{onClick:this.addTask},"添加任务")),_["default"].createElement(D.VpModal,{title:"关联内容",visible:i.visible,okText:"确定",cancelText:"取消",style:{height:"80%"},className:"taskModal",key:i.visible,footer:null,width:"80%",maskClosable:!1},_["default"].createElement(C["default"],{entityid:s.entityid,iid:s.iid,origin:s.origin,getRelatedContent:this.RelatedContentOk,onCancel:this.RelatedContenttoogleModal}))))}}]),t}(T.Component);S.defaultPoprs={isAddTask:!1,sdisabled:!0,isRequiredSdetails:!1,dayhours:{sj_ihoursofday:0,sj_ioverhoursofday:0},deleteTD:function(){}};var V=function(e){function t(e){(0,v["default"])(this,t);var a=(0,b["default"])(this,(t.__proto__||(0,h["default"])(t)).call(this));return a.state={texts:["应报工时","已报工时","未报工时"]},a}return(0,M["default"])(t,e),(0,w["default"])(t,[{key:"render",value:function(){var e=this.props.texts||this.state.texts;return _["default"].createElement(D.VpRow,{span:5},_["default"].createElement("div",{className:this.props.className},_["default"].createElement("div",{className:"text-centerCZ"},_["default"].createElement("div",{className:"m-b-sm p-t-sm fw"},this.props.text),_["default"].createElement("div",{className:"ant-row p-tb-sm"},_["default"].createElement("div",{className:"ant-col-8"},_["default"].createElement("div",{className:"text-primary f30"},this.props.val[this.props.keys[0]]),_["default"].createElement("div",{className:"text-muted"},e[0])),_["default"].createElement("div",{className:"ant-col-8"},_["default"].createElement("div",{className:"text-info f30"},this.props.val[this.props.keys[1]]),_["default"].createElement("div",{className:"text-muted"},e[1])),_["default"].createElement("div",{className:"ant-col-8"},_["default"].createElement("div",{className:"text-warning f30"},this.props.val[this.props.keys[2]]),_["default"].createElement("div",{className:"text-muted"},e[2]))))))}}]),t}(T.Component);t["default"]=x},1296:function(e,t,a){var l=a(1297);"string"==typeof l&&(l=[[e.id,l,""]]);var n={hmr:!0};n.transform=void 0;a(465)(l,n);l.locals&&(e.exports=l.locals)},1297:function(e,t){}});